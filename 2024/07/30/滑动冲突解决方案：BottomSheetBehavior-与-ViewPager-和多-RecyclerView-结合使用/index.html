
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>滑动冲突解决方案：BottomSheetBehavior 与 ViewPager 和多 RecyclerView 结合使用 - Fox Hound</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="ArnoFrost FoxHound,"> 
    <meta name="description" content="Life should be so,1. 问题背景BottomSheetBehavior 是 Jetpack Compose 库中的一个行为类，它为 CoordinatorLayout 中的子视图提供了展开和折叠的交互功能。这种交互在,"> 
    <meta name="author" content="Arno Frost"> 
    <link rel="alternative" href="atom.xml" title="Fox Hound" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 7.2.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Fox Hound</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://arnoforst.github.io"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">滑动冲突解决方案：BottomSheetBehavior 与 ViewPager 和多 RecyclerView 结合使用</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">滑动冲突解决方案：BottomSheetBehavior 与 ViewPager 和多 RecyclerView 结合使用</h1>
        <div class="stuff">
            <span>七月 30, 2024</span>
            

        </div>
        <div class="content markdown">
            <h2 id="1-问题背景"><a href="#1-问题背景" class="headerlink" title="1. 问题背景"></a>1. 问题背景</h2><p><code>BottomSheetBehavior</code> 是 Jetpack Compose 库中的一个行为类，它为 <code>CoordinatorLayout</code> 中的子视图提供了展开和折叠的交互功能。这种交互在 Android 应用中非常流行，尤其是在需要展示额外信息或选项时。<code>BottomSheetBehavior</code> 允许开发者自定义底部 Sheet 的行为，例如设置不同的展开状态、滑动灵敏度以及与用户交互时的动画效果。</p>
<h2 id="2-冲突原因分析"><a href="#2-冲突原因分析" class="headerlink" title="2. 冲突原因分析"></a>2. 冲突原因分析</h2><ul>
<li><code>BottomSheetBehavior</code> 默认只处理第一个可滑动子视图。</li>
<li>滑动事件被 <code>RecyclerView</code> 完全消费，导致 <code>BottomSheetBehavior</code> 的滑动弹出和关闭功能失效。</li>
</ul>
<h2 id="3-自定义-MyViewPagerBottomSheetBehavior"><a href="#3-自定义-MyViewPagerBottomSheetBehavior" class="headerlink" title="3. 自定义 MyViewPagerBottomSheetBehavior"></a>3. 自定义 MyViewPagerBottomSheetBehavior</h2><p>重写 <code>findScrollingChild</code> 方法以支持 <code>ViewPager</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    <span class="meta">@VisibleForTesting</span>    View <span class="title function_">findScrollingChild</span><span class="params">(View view)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        globalView = view;  </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> isScrollViewOnTopMap.getOrDefault(currentPagePosition, <span class="literal">false</span>);  </span><br><span class="line">        <span class="keyword">if</span> (b) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (ViewCompat.isNestedScrollingEnabled(view)) &#123;  </span><br><span class="line">            <span class="keyword">return</span> view;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewPager) &#123;  </span><br><span class="line">            <span class="type">ViewPager</span> <span class="variable">viewPager</span> <span class="operator">=</span> (ViewPager) view;  </span><br><span class="line">            <span class="keyword">if</span> (isFirstFind) &#123;  </span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Objects.requireNonNull(viewPager.getAdapter()).getCount(); i++) &#123;  </span><br><span class="line">                    isScrollViewOnTopMap.put(i, <span class="literal">true</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">                viewPager.addOnPageChangeListener(<span class="keyword">new</span> <span class="title class_">ViewPager</span>.OnPageChangeListener() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrolled</span><span class="params">(<span class="type">int</span> position, <span class="type">float</span> positionOffset, <span class="type">int</span> positionOffsetPixels)</span> &#123;  </span><br><span class="line">                        currentPagePosition = position;  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="type">int</span> position)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrollStateChanged</span><span class="params">(<span class="type">int</span> state)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br><span class="line">                isFirstFind = <span class="literal">false</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="comment">// 修改此处直接使用原生方法来代替原文的通过反射获取的方法</span></span><br><span class="line">            <span class="type">View</span> <span class="variable">currentViewPagerChild</span> <span class="operator">=</span> viewPager.getChildAt(viewPager.getCurrentItem());  </span><br><span class="line"><span class="comment">//            View currentViewPagerChild = ViewPagerUtils.getCurrentView(viewPager);  </span></span><br><span class="line">            <span class="type">View</span> <span class="variable">scrollingChild</span> <span class="operator">=</span> findScrollingChild(currentViewPagerChild);  </span><br><span class="line">            <span class="keyword">if</span> (scrollingChild != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">return</span> scrollingChild;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> currentViewPagerChild;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;  </span><br><span class="line">            <span class="type">ViewGroup</span> <span class="variable">group</span> <span class="operator">=</span> (ViewGroup) view;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, count = group.getChildCount(); i &lt; count; i++) &#123;  </span><br><span class="line">                <span class="type">View</span> <span class="variable">scrollingChild</span> <span class="operator">=</span> findScrollingChild(group.getChildAt(i));  </span><br><span class="line">                <span class="keyword">if</span> (scrollingChild != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="keyword">return</span> scrollingChild;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-处理-ViewPager-联动"><a href="#4-处理-ViewPager-联动" class="headerlink" title="4. 处理 ViewPager 联动"></a>4. 处理 ViewPager 联动</h2><ul>
<li>添加 <code>isScrollViewOnTopMap</code> 来跟踪每个页面的滑动状态。</li>
<li>为 <code>ViewPager</code> 添加页面变化监听，动态更新 <code>isScrollViewOnTopMap</code>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 针对viewpager联动</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isFirstFind</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">private</span> HashMap&lt;Integer, Boolean&gt; isScrollViewOnTopMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">currentPagePosition</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="5-刷新滑动控件方法"><a href="#5-刷新滑动控件方法" class="headerlink" title="5. 刷新滑动控件方法"></a>5. 刷新滑动控件方法</h2><p>创建 <code>notifyScrollView</code> 方法以刷新找到的滑动控件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">notifyScrollView</span><span class="params">()</span> &#123;</span><br><span class="line">    nestedScrollingChildRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(findScrollingChild(globalView));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-暴露设置滑动顶部状态的方法"><a href="#6-暴露设置滑动顶部状态的方法" class="headerlink" title="6. 暴露设置滑动顶部状态的方法"></a>6. 暴露设置滑动顶部状态的方法</h2><p>提供 <code>setCurrentScrollViewOnTop</code> 公开方法，允许外部修改滑动顶部状态。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentScrollViewOnTop</span><span class="params">(<span class="type">boolean</span> scrollViewOnTop)</span> &#123;</span><br><span class="line">    isScrollViewOnTopMap.put(currentPagePosition, scrollViewOnTop);  </span><br><span class="line">    notifyScrollView();  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//修改nestedScrollingChildRef用于让滑动事件可以在behavior与rv/lv中进行切换</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">notifyScrollView</span><span class="params">()</span> &#123;  </span><br><span class="line">    nestedScrollingChildRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(findScrollingChild(globalView));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-监听-RecyclerView-滑动"><a href="#7-监听-RecyclerView-滑动" class="headerlink" title="7. 监听 RecyclerView 滑动"></a>7. 监听 RecyclerView 滑动</h2><p>在 <code>RecyclerView</code> 的 <code>OnScrollListener</code> 中，根据滑动状态更新 <code>Behavior</code> 的滑动顶部状态。<br>RV实现:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">rvList.addOnScrollListener(<span class="keyword">new</span> <span class="title class_">RecyclerView</span>.OnScrollListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onScrolled</span><span class="params">(<span class="meta">@NonNull</span> RecyclerView recyclerView, <span class="type">int</span> dx, <span class="type">int</span> dy)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (behavior != <span class="literal">null</span>) &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;!!!!!!!!!&quot;</span>, String.valueOf(!recyclerView.canScrollVertically(-<span class="number">1</span>)) + dy);</span><br><span class="line">            <span class="keyword">if</span> (dy == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//指尖未真实上下滑动（针对从viewpager其他页面切换过来时），不做任何操作</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!recyclerView.canScrollVertically(-<span class="number">1</span>) &amp;&amp; dy &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//不可以下拉，并且手势是下拉，通知behavior已经列表已经在顶部了</span></span><br><span class="line">                Log.d(<span class="string">&quot;~~~~~&quot;</span>, <span class="string">&quot;划不动了&quot;</span>);</span><br><span class="line">                behavior.setCurrentScrollViewOnTop(<span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//可以下拉或者手势不是下拉，通知behavior已经列表不在顶部</span></span><br><span class="line">                behavior.setCurrentScrollViewOnTop(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>LV实现:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> previousFirstVisibleItem = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onScroll</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        view: <span class="type">AbsListView</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        firstVisibleItem: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        visibleItemCount: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        totalItemCount: <span class="type">Int</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onScroll(view, firstVisibleItem, visibleItemCount, totalItemCount)</span><br><span class="line">        <span class="comment">// 判断滚动方向</span></span><br><span class="line">        <span class="keyword">if</span> (view != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (previousFirstVisibleItem == -<span class="number">1</span>) &#123;</span><br><span class="line">                previousFirstVisibleItem = firstVisibleItem</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstVisibleItem &lt; previousFirstVisibleItem) &#123;</span><br><span class="line">                <span class="comment">// 向下滚动</span></span><br><span class="line">                <span class="keyword">if</span> (firstVisibleItem == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// 列表已经滚动到顶部</span></span><br><span class="line">                    behavior.setCurrentScrollViewOnTop(<span class="literal">true</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    behavior.setCurrentScrollViewOnTop(<span class="literal">false</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstVisibleItem &gt; previousFirstVisibleItem) &#123;</span><br><span class="line">                <span class="comment">// 向上滚动</span></span><br><span class="line">                <span class="keyword">if</span> (firstVisibleItem + visibleItemCount == totalItemCount) &#123;</span><br><span class="line">                    <span class="comment">// 列表已经滚动到底部</span></span><br><span class="line">                    behavior.setCurrentScrollViewOnTop(<span class="literal">false</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    behavior.setCurrentScrollViewOnTop(<span class="literal">false</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            previousFirstVisibleItem = firstVisibleItem</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-实现细节"><a href="#8-实现细节" class="headerlink" title="8. 实现细节"></a>8. 实现细节</h2><ul>
<li>使用 ViewPager 的原生方法获取，原文参考使用了反射没有必要同时还增加了风险。</li>
<li>除了自定义 behavior 外，还需要自定义 <code>CustomBottomSheetDialog</code> 这样才能让 Dialog 的 set 的 behavior 是自定义类的 behavior，否则 behavior 不会生效。</li>
</ul>
<h2 id="9-参考资料"><a href="#9-参考资料" class="headerlink" title="9. 参考资料"></a>9. 参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://zyf99.github.io/Blog/2020/12/07/BottomSheetBehavior-ViewPager-%E5%A4%9ARecyclerView-%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81%EF%BC%88%E6%BB%91%E5%8A%A8%E5%BC%B9%E5%87%BA%E9%9A%90%E8%97%8F%EF%BC%89%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">BottomSheetBehavior+ViewPager+多RecyclerView 滑动冲突（滑动弹出隐藏）终极解决方案 - ZEKI SPACE</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jason_HD/article/details/121020496">BottomSheetDialogFragment + ViewPager+Fragment+RecyclerView 滑动问题</a></li>
</ul>
<h2 id="10-完整代码"><a href="#10-完整代码" class="headerlink" title="10. 完整代码"></a>10. 完整代码</h2><p>design_minibar_bottom_sheet_dialog.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">  ~ Copyright (C) 2015 The Android Open Source Project  ~  ~ Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);  ~ you may not use this file except in compliance with the License.  ~ You may obtain a copy of the License at  ~  ~      http://www.apache.org/licenses/LICENSE-2.0  ~  ~ Unless required by applicable law or agreed to in writing, software  ~ distributed under the License is distributed on an &quot;AS IS&quot; BASIS,  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  ~ See the License for the specific language governing permissions and  ~ limitations under the License.--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.coordinatorlayout.widget.CoordinatorLayout</span>        <span class="attr">android:id</span>=<span class="string">&quot;@+id/coordinator&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="tag">&lt;<span class="name">View</span>            <span class="attr">android:id</span>=<span class="string">&quot;@+id/touch_outside&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:focusable</span>=<span class="string">&quot;false&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:importantForAccessibility</span>=<span class="string">&quot;no&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:soundEffectsEnabled</span>=<span class="string">&quot;false&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">tools:ignore</span>=<span class="string">&quot;UnusedAttribute&quot;</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="tag">&lt;<span class="name">FrameLayout</span>            <span class="attr">android:id</span>=<span class="string">&quot;@+id/design_bottom_sheet&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">&quot;?attr/bottomSheetStyle&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center_horizontal|top&quot;</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_behavior</span>=<span class="string">&quot;com.base.custom.MinibarViewPagerBottomSheetBehavior&quot;</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.coordinatorlayout.widget.CoordinatorLayout</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MinibarViewPagerBottomSheetBehavior.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.base.custom;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> androidx.annotation.RestrictTo.Scope.LIBRARY_GROUP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> android.animation.ValueAnimator;  </span><br><span class="line"><span class="keyword">import</span> android.animation.ValueAnimator.AnimatorUpdateListener;  </span><br><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;  </span><br><span class="line"><span class="keyword">import</span> android.content.Context;  </span><br><span class="line"><span class="keyword">import</span> android.content.res.ColorStateList;  </span><br><span class="line"><span class="keyword">import</span> android.content.res.TypedArray;  </span><br><span class="line"><span class="keyword">import</span> android.os.Build.VERSION;  </span><br><span class="line"><span class="keyword">import</span> android.os.Build.VERSION_CODES;  </span><br><span class="line"><span class="keyword">import</span> android.os.Parcel;  </span><br><span class="line"><span class="keyword">import</span> android.os.Parcelable;  </span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;  </span><br><span class="line"><span class="keyword">import</span> android.util.Log;  </span><br><span class="line"><span class="keyword">import</span> android.util.TypedValue;  </span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;  </span><br><span class="line"><span class="keyword">import</span> android.view.VelocityTracker;  </span><br><span class="line"><span class="keyword">import</span> android.view.View;  </span><br><span class="line"><span class="keyword">import</span> android.view.ViewConfiguration;  </span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;  </span><br><span class="line"><span class="keyword">import</span> android.view.ViewParent;  </span><br><span class="line"><span class="keyword">import</span> android.view.WindowInsets;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.FloatRange;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.IntDef;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.RestrictTo;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.VisibleForTesting;  </span><br><span class="line"><span class="keyword">import</span> androidx.coordinatorlayout.widget.CoordinatorLayout;  </span><br><span class="line"><span class="keyword">import</span> androidx.coordinatorlayout.widget.CoordinatorLayout.LayoutParams;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.math.MathUtils;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.ViewCompat;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.accessibility.AccessibilityNodeInfoCompat;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.accessibility.AccessibilityNodeInfoCompat.AccessibilityActionCompat;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.accessibility.AccessibilityViewCommand;  </span><br><span class="line"><span class="keyword">import</span> androidx.customview.view.AbsSavedState;  </span><br><span class="line"><span class="keyword">import</span> androidx.customview.widget.ViewDragHelper;  </span><br><span class="line"><span class="keyword">import</span> androidx.viewpager.widget.ViewPager;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.google.android.material.R;  </span><br><span class="line"><span class="keyword">import</span> com.google.android.material.bottomsheet.BottomSheetBehavior;  </span><br><span class="line"><span class="keyword">import</span> com.google.android.material.resources.MaterialResources;  </span><br><span class="line"><span class="keyword">import</span> com.google.android.material.shape.MaterialShapeDrawable;  </span><br><span class="line"><span class="keyword">import</span> com.google.android.material.shape.ShapeAppearanceModel;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;  </span><br><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;  </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line"><span class="keyword">import</span> java.util.Objects;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinibarViewPagerBottomSheetBehavior</span>&lt;V <span class="keyword">extends</span> <span class="title class_">View</span>&gt; <span class="keyword">extends</span> <span class="title class_">CoordinatorLayout</span>.Behavior&lt;V&gt; &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Callback for monitoring events about bottom sheets.     */</span>    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BottomSheetCallback</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * Called when the bottom sheet changes its state.         *         * <span class="doctag">@param</span> bottomSheet The bottom sheet view.  </span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> newState    The new state. This will be one of &#123;<span class="doctag">@link</span> #STATE_DRAGGING&#125;, &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">         *                    #STATE_SETTLING&#125;, &#123;<span class="doctag">@link</span> #STATE_EXPANDED&#125;, &#123;<span class="doctag">@link</span> #STATE_COLLAPSED&#125;, &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">         *                    #STATE_HIDDEN&#125;, or &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125;.  </span></span><br><span class="line"><span class="comment">         */</span>        <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(<span class="meta">@NonNull</span> View bottomSheet, <span class="meta">@State</span> <span class="type">int</span> newState)</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * Called when the bottom sheet is being dragged.         *         * <span class="doctag">@param</span> bottomSheet The bottom sheet view.  </span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> slideOffset The new offset of this bottom sheet within [-1,1] range. Offset increases  </span></span><br><span class="line"><span class="comment">         *                    as this bottom sheet is moving upward. From 0 to 1 the sheet is between collapsed and         *                    expanded states and from -1 to 0 it is between hidden and collapsed states.         */</span>        <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">onSlide</span><span class="params">(<span class="meta">@NonNull</span> View bottomSheet, <span class="type">float</span> slideOffset)</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * The bottom sheet is dragging.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_DRAGGING</span> <span class="operator">=</span> <span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * The bottom sheet is settling.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_SETTLING</span> <span class="operator">=</span> <span class="number">2</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * The bottom sheet is expanded.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_EXPANDED</span> <span class="operator">=</span> <span class="number">3</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * The bottom sheet is collapsed.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_COLLAPSED</span> <span class="operator">=</span> <span class="number">4</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * The bottom sheet is hidden.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_HIDDEN</span> <span class="operator">=</span> <span class="number">5</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * The bottom sheet is half-expanded (used when mFitToContents is false).     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_HALF_EXPANDED</span> <span class="operator">=</span> <span class="number">6</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span>  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@RestrictTo(LIBRARY_GROUP)</span>  </span><br><span class="line">    <span class="meta">@IntDef(&#123;  </span></span><br><span class="line"><span class="meta">            STATE_EXPANDED,  </span></span><br><span class="line"><span class="meta">            STATE_COLLAPSED,  </span></span><br><span class="line"><span class="meta">            STATE_DRAGGING,  </span></span><br><span class="line"><span class="meta">            STATE_SETTLING,  </span></span><br><span class="line"><span class="meta">            STATE_HIDDEN,  </span></span><br><span class="line"><span class="meta">            STATE_HALF_EXPANDED  </span></span><br><span class="line"><span class="meta">    &#125;)</span>  </span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.SOURCE)</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> State &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Peek at the 16:9 ratio keyline of its parent.     *     * &lt;p&gt;This can be used as a parameter for &#123;<span class="doctag">@link</span> #setPeekHeight(int)&#125;. &#123;<span class="doctag">@link</span> #getPeekHeight()&#125;  </span></span><br><span class="line"><span class="comment">     * will return this when the value is set.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PEEK_HEIGHT_AUTO</span> <span class="operator">=</span> -<span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This flag will preserve the peekHeight int value on configuration change.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SAVE_PEEK_HEIGHT</span> <span class="operator">=</span> <span class="number">0x1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This flag will preserve the fitToContents boolean value on configuration change.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SAVE_FIT_TO_CONTENTS</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This flag will preserve the hideable boolean value on configuration change.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SAVE_HIDEABLE</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">2</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This flag will preserve the skipCollapsed boolean value on configuration change.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SAVE_SKIP_COLLAPSED</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">3</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This flag will preserve all aforementioned values on configuration change.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SAVE_ALL</span> <span class="operator">=</span> -<span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This flag will not preserve the aforementioned values set at runtime if the view is destroyed     * and recreated. The only value preserved will be the positional state, e.g. collapsed, hidden,     * expanded, etc. This is the default behavior.     */</span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SAVE_NONE</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span>  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@RestrictTo(LIBRARY_GROUP)</span>  </span><br><span class="line">    <span class="meta">@IntDef(  </span></span><br><span class="line"><span class="meta">            flag = true,  </span></span><br><span class="line"><span class="meta">            value = &#123;  </span></span><br><span class="line"><span class="meta">                    SAVE_PEEK_HEIGHT,  </span></span><br><span class="line"><span class="meta">                    SAVE_FIT_TO_CONTENTS,  </span></span><br><span class="line"><span class="meta">                    SAVE_HIDEABLE,  </span></span><br><span class="line"><span class="meta">                    SAVE_SKIP_COLLAPSED,  </span></span><br><span class="line"><span class="meta">                    SAVE_ALL,  </span></span><br><span class="line"><span class="meta">                    SAVE_NONE,  </span></span><br><span class="line"><span class="meta">            &#125;)</span>  </span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.SOURCE)</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> SaveFlags &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;BottomSheetBehavior&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@SaveFlags</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">saveFlags</span> <span class="operator">=</span> SAVE_NONE;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SIGNIFICANT_VEL_THRESHOLD</span> <span class="operator">=</span> <span class="number">500</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">HIDE_THRESHOLD</span> <span class="operator">=</span> <span class="number">0.5f</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">HIDE_FRICTION</span> <span class="operator">=</span> <span class="number">0.1f</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CORNER_ANIMATION_DURATION</span> <span class="operator">=</span> <span class="number">500</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">fitToContents</span> <span class="operator">=</span> <span class="literal">true</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">updateImportantForAccessibilityOnSiblings</span> <span class="operator">=</span> <span class="literal">false</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> maximumVelocity;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Peek height set by the user.     */</span>    <span class="keyword">private</span> <span class="type">int</span> peekHeight;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Whether or not to use automatic peek height.     */</span>    <span class="keyword">private</span> <span class="type">boolean</span> peekHeightAuto;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Minimum peek height permitted.     */</span>    <span class="keyword">private</span> <span class="type">int</span> peekHeightMin;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * True if Behavior has a non-null value for the <span class="doctag">@shapeAppearance</span> attribute     */</span>    <span class="keyword">private</span> <span class="type">boolean</span> shapeThemingEnabled;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> MaterialShapeDrawable materialShapeDrawable;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> gestureInsetBottomIgnored;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Default Shape Appearance to be used in bottomsheet     */</span>    <span class="keyword">private</span> ShapeAppearanceModel shapeAppearanceModelDefault;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isShapeExpanded;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">SettleRunnable</span> <span class="variable">settleRunnable</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    <span class="keyword">private</span> ValueAnimator interpolatorAnimator;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEF_STYLE_RES</span> <span class="operator">=</span> R.style.Widget_Design_BottomSheet_Modal;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">int</span> expandedOffset;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">int</span> fitToContentsOffset;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">int</span> halfExpandedOffset;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">float</span> <span class="variable">halfExpandedRatio</span> <span class="operator">=</span> <span class="number">0.5f</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">int</span> collapsedOffset;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">float</span> <span class="variable">elevation</span> <span class="operator">=</span> -<span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> hideable;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> skipCollapsed;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">draggable</span> <span class="operator">=</span> <span class="literal">true</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@State</span>  </span><br><span class="line">    <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> STATE_COLLAPSED;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    ViewDragHelper viewDragHelper;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> ignoreEvents;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> lastNestedScrollDy;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> nestedScrolled;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">int</span> parentWidth;  </span><br><span class="line">    <span class="type">int</span> parentHeight;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    WeakReference&lt;V&gt; viewRef;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    WeakReference&lt;View&gt; nestedScrollingChildRef;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@NonNull</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;BottomSheetCallback&gt; callbacks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    <span class="keyword">private</span> VelocityTracker velocityTracker;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">int</span> activePointerId;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> initialY;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> touchingScrollingChild;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    <span class="keyword">private</span> Map&lt;View, Integer&gt; importantForAccessibilityMap;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinibarViewPagerBottomSheetBehavior</span><span class="params">()</span> &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinibarViewPagerBottomSheetBehavior</span><span class="params">(<span class="meta">@NonNull</span> Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>(context, attrs);  </span><br><span class="line">        <span class="type">TypedArray</span> <span class="variable">a</span> <span class="operator">=</span> context.obtainStyledAttributes(attrs, R.styleable.BottomSheetBehavior_Layout);  </span><br><span class="line">        <span class="built_in">this</span>.shapeThemingEnabled = a.hasValue(R.styleable.BottomSheetBehavior_Layout_shapeAppearance);  </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasBackgroundTint</span> <span class="operator">=</span> a.hasValue(R.styleable.BottomSheetBehavior_Layout_backgroundTint);  </span><br><span class="line">        <span class="keyword">if</span> (hasBackgroundTint) &#123;  </span><br><span class="line">            <span class="meta">@SuppressLint(&quot;RestrictedApi&quot;)</span> <span class="type">ColorStateList</span> <span class="variable">bottomSheetColor</span> <span class="operator">=</span>  </span><br><span class="line">                    MaterialResources.getColorStateList(  </span><br><span class="line">                            context, a, R.styleable.BottomSheetBehavior_Layout_backgroundTint);  </span><br><span class="line">            createMaterialShapeDrawable(context, attrs, hasBackgroundTint, bottomSheetColor);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            createMaterialShapeDrawable(context, attrs, hasBackgroundTint);  </span><br><span class="line">        &#125;  </span><br><span class="line">        createShapeValueAnimator();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.LOLLIPOP) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.elevation = a.getDimension(R.styleable.BottomSheetBehavior_Layout_android_elevation, -<span class="number">1</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TypedValue</span> <span class="variable">value</span> <span class="operator">=</span> a.peekValue(R.styleable.BottomSheetBehavior_Layout_behavior_peekHeight);  </span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span> &amp;&amp; value.data == PEEK_HEIGHT_AUTO) &#123;  </span><br><span class="line">            setPeekHeight(value.data);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            setPeekHeight(  </span><br><span class="line">                    a.getDimensionPixelSize(  </span><br><span class="line">                            R.styleable.BottomSheetBehavior_Layout_behavior_peekHeight, PEEK_HEIGHT_AUTO));  </span><br><span class="line">        &#125;  </span><br><span class="line">        setHideable(a.getBoolean(R.styleable.BottomSheetBehavior_Layout_behavior_hideable, <span class="literal">false</span>));  </span><br><span class="line">        setGestureInsetBottomIgnored(  </span><br><span class="line">                a.getBoolean(R.styleable.BottomSheetBehavior_Layout_gestureInsetBottomIgnored, <span class="literal">false</span>));  </span><br><span class="line">        setFitToContents(  </span><br><span class="line">                a.getBoolean(R.styleable.BottomSheetBehavior_Layout_behavior_fitToContents, <span class="literal">true</span>));  </span><br><span class="line">        setSkipCollapsed(  </span><br><span class="line">                a.getBoolean(R.styleable.BottomSheetBehavior_Layout_behavior_skipCollapsed, <span class="literal">false</span>));  </span><br><span class="line">        setDraggable(a.getBoolean(R.styleable.BottomSheetBehavior_Layout_behavior_draggable, <span class="literal">true</span>));  </span><br><span class="line">        setSaveFlags(a.getInt(R.styleable.BottomSheetBehavior_Layout_behavior_saveFlags, SAVE_NONE));  </span><br><span class="line">        setHalfExpandedRatio(  </span><br><span class="line">                a.getFloat(R.styleable.BottomSheetBehavior_Layout_behavior_halfExpandedRatio, <span class="number">0.5f</span>));  </span><br><span class="line">  </span><br><span class="line">        value = a.peekValue(R.styleable.BottomSheetBehavior_Layout_behavior_expandedOffset);  </span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span> &amp;&amp; value.type == TypedValue.TYPE_FIRST_INT) &#123;  </span><br><span class="line">            setExpandedOffset(value.data);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            setExpandedOffset(  </span><br><span class="line">                    a.getDimensionPixelOffset(  </span><br><span class="line">                            R.styleable.BottomSheetBehavior_Layout_behavior_expandedOffset, <span class="number">0</span>));  </span><br><span class="line">        &#125;  </span><br><span class="line">        a.recycle();  </span><br><span class="line">        <span class="type">ViewConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> ViewConfiguration.get(context);  </span><br><span class="line">        maximumVelocity = configuration.getScaledMaximumFlingVelocity();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@NonNull</span>  </span><br><span class="line">    <span class="meta">@Override</span>    <span class="keyword">public</span> Parcelable <span class="title function_">onSaveInstanceState</span><span class="params">(<span class="meta">@NonNull</span> CoordinatorLayout parent, <span class="meta">@NonNull</span> V child)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SavedState</span>(<span class="built_in">super</span>.onSaveInstanceState(parent, child), <span class="built_in">this</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRestoreInstanceState</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout parent, <span class="meta">@NonNull</span> V child, <span class="meta">@NonNull</span> Parcelable state)</span> &#123;  </span><br><span class="line">        <span class="type">SavedState</span> <span class="variable">ss</span> <span class="operator">=</span> (SavedState) state;  </span><br><span class="line">        <span class="built_in">super</span>.onRestoreInstanceState(parent, child, ss.getSuperState());  </span><br><span class="line">        <span class="comment">// Restore Optional State values designated by saveFlags  </span></span><br><span class="line">        restoreOptionalState(ss);  </span><br><span class="line">        <span class="comment">// Intermediate states are restored as collapsed state  </span></span><br><span class="line">        <span class="keyword">if</span> (ss.state == STATE_DRAGGING || ss.state == STATE_SETTLING) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.state = STATE_COLLAPSED;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="built_in">this</span>.state = ss.state;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttachedToLayoutParams</span><span class="params">(<span class="meta">@NonNull</span> LayoutParams layoutParams)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.onAttachedToLayoutParams(layoutParams);  </span><br><span class="line">        <span class="comment">// These may already be null, but just be safe, explicitly assign them. This lets us know the  </span></span><br><span class="line">        <span class="comment">// first time we layout with this behavior by checking (viewRef == null).        viewRef = null;  </span></span><br><span class="line">        viewDragHelper = <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDetachedFromLayoutParams</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.onDetachedFromLayoutParams();  </span><br><span class="line">        <span class="comment">// Release references so we don&#x27;t run unnecessary codepaths while not attached to a view.  </span></span><br><span class="line">        viewRef = <span class="literal">null</span>;  </span><br><span class="line">        viewDragHelper = <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onLayoutChild</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout parent, <span class="meta">@NonNull</span> V child, <span class="type">int</span> layoutDirection)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (ViewCompat.getFitsSystemWindows(parent) &amp;&amp; !ViewCompat.getFitsSystemWindows(child)) &#123;  </span><br><span class="line">            child.setFitsSystemWindows(<span class="literal">true</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (viewRef == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="comment">// First layout with this behavior.  </span></span><br><span class="line">            peekHeightMin =  </span><br><span class="line">                    parent.getResources().getDimensionPixelSize(R.dimen.design_bottom_sheet_peek_height_min);  </span><br><span class="line">            setSystemGestureInsets(parent);  </span><br><span class="line">            viewRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(child);  </span><br><span class="line">            <span class="comment">// Only set MaterialShapeDrawable as background if shapeTheming is enabled, otherwise will  </span></span><br><span class="line">            <span class="comment">// default to android:background declared in styles or layout.            if (shapeThemingEnabled &amp;&amp; materialShapeDrawable != null) &#123;  </span></span><br><span class="line">                ViewCompat.setBackground(child, materialShapeDrawable);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="comment">// Set elevation on MaterialShapeDrawable  </span></span><br><span class="line">            <span class="keyword">if</span> (materialShapeDrawable != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// Use elevation attr if set on bottomsheet; otherwise, use elevation of child view.  </span></span><br><span class="line">                materialShapeDrawable.setElevation(  </span><br><span class="line">                        elevation == -<span class="number">1</span> ? ViewCompat.getElevation(child) : elevation);  </span><br><span class="line">                <span class="comment">// Update the material shape based on initial state.  </span></span><br><span class="line">                isShapeExpanded = state == STATE_EXPANDED;  </span><br><span class="line">                materialShapeDrawable.setInterpolation(isShapeExpanded ? <span class="number">0f</span> : <span class="number">1f</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">            updateAccessibilityActions();  </span><br><span class="line">            <span class="keyword">if</span> (ViewCompat.getImportantForAccessibility(child)  </span><br><span class="line">                    == ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_AUTO) &#123;  </span><br><span class="line">                ViewCompat.setImportantForAccessibility(child, ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_YES);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (viewDragHelper == <span class="literal">null</span>) &#123;  </span><br><span class="line">            viewDragHelper = ViewDragHelper.create(parent, dragCallback);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">int</span> <span class="variable">savedTop</span> <span class="operator">=</span> child.getTop();  </span><br><span class="line">        <span class="comment">// First let the parent lay it out  </span></span><br><span class="line">        parent.onLayoutChild(child, layoutDirection);  </span><br><span class="line">        <span class="comment">// Offset the bottom sheet  </span></span><br><span class="line">        parentWidth = parent.getWidth();  </span><br><span class="line">        parentHeight = parent.getHeight();  </span><br><span class="line">        fitToContentsOffset = Math.max(<span class="number">0</span>, parentHeight - child.getHeight());  </span><br><span class="line">        calculateHalfExpandedOffset();  </span><br><span class="line">        calculateCollapsedOffset();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (state == STATE_EXPANDED) &#123;  </span><br><span class="line">            ViewCompat.offsetTopAndBottom(child, getExpandedOffset());  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == STATE_HALF_EXPANDED) &#123;  </span><br><span class="line">            ViewCompat.offsetTopAndBottom(child, halfExpandedOffset);  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hideable &amp;&amp; state == STATE_HIDDEN) &#123;  </span><br><span class="line">            ViewCompat.offsetTopAndBottom(child, parentHeight);  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == STATE_COLLAPSED) &#123;  </span><br><span class="line">            ViewCompat.offsetTopAndBottom(child, collapsedOffset);  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == STATE_DRAGGING || state == STATE_SETTLING) &#123;  </span><br><span class="line">            ViewCompat.offsetTopAndBottom(child, savedTop - child.getTop());  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        nestedScrollingChildRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(findScrollingChild(child));  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onInterceptTouchEvent</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout parent, <span class="meta">@NonNull</span> V child, <span class="meta">@NonNull</span> MotionEvent event)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (!child.isShown() || !draggable) &#123;  </span><br><span class="line">            ignoreEvents = <span class="literal">true</span>;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> event.getActionMasked();  </span><br><span class="line">        <span class="comment">// Record the velocity  </span></span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_DOWN) &#123;  </span><br><span class="line">            reset();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (velocityTracker == <span class="literal">null</span>) &#123;  </span><br><span class="line">            velocityTracker = VelocityTracker.obtain();  </span><br><span class="line">        &#125;  </span><br><span class="line">        velocityTracker.addMovement(event);  </span><br><span class="line">        <span class="keyword">switch</span> (action) &#123;  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:  </span><br><span class="line">                touchingScrollingChild = <span class="literal">false</span>;  </span><br><span class="line">                activePointerId = MotionEvent.INVALID_POINTER_ID;  </span><br><span class="line">                <span class="comment">// Reset the ignore flag  </span></span><br><span class="line">                <span class="keyword">if</span> (ignoreEvents) &#123;  </span><br><span class="line">                    ignoreEvents = <span class="literal">false</span>;  </span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:  </span><br><span class="line">                <span class="type">int</span> <span class="variable">initialX</span> <span class="operator">=</span> (<span class="type">int</span>) event.getX();  </span><br><span class="line">                initialY = (<span class="type">int</span>) event.getY();  </span><br><span class="line">                <span class="comment">// Only intercept nested scrolling events here if the view not being moved by the  </span></span><br><span class="line">                <span class="comment">// ViewDragHelper.                if (state != STATE_SETTLING) &#123;  </span></span><br><span class="line">                    <span class="type">View</span> <span class="variable">scroll</span> <span class="operator">=</span> nestedScrollingChildRef != <span class="literal">null</span> ? nestedScrollingChildRef.get() : <span class="literal">null</span>;  </span><br><span class="line">                    <span class="keyword">if</span> (scroll != <span class="literal">null</span> &amp;&amp; parent.isPointInChildBounds(scroll, initialX, initialY)) &#123;  </span><br><span class="line">                        activePointerId = event.getPointerId(event.getActionIndex());  </span><br><span class="line">                        touchingScrollingChild = <span class="literal">true</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                ignoreEvents =  </span><br><span class="line">                        activePointerId == MotionEvent.INVALID_POINTER_ID  </span><br><span class="line">                                &amp;&amp; !parent.isPointInChildBounds(child, initialX, initialY);  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">default</span>: <span class="comment">// fall out  </span></span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (!ignoreEvents  </span><br><span class="line">                &amp;&amp; viewDragHelper != <span class="literal">null</span>  </span><br><span class="line">                &amp;&amp; viewDragHelper.shouldInterceptTouchEvent(event)) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// We have to handle cases that the ViewDragHelper does not capture the bottom sheet because  </span></span><br><span class="line">        <span class="comment">// it is not the top most view of its parent. This is not necessary when the touch event is        // happening over the scrolling content as nested scrolling logic handles that case.        View scroll = nestedScrollingChildRef != null ? nestedScrollingChildRef.get() : null;  </span></span><br><span class="line">        <span class="keyword">return</span> action == MotionEvent.ACTION_MOVE  </span><br><span class="line">                &amp;&amp; scroll != <span class="literal">null</span>  </span><br><span class="line">                &amp;&amp; !ignoreEvents  </span><br><span class="line">                &amp;&amp; state != STATE_DRAGGING  </span><br><span class="line">                &amp;&amp; !parent.isPointInChildBounds(scroll, (<span class="type">int</span>) event.getX(), (<span class="type">int</span>) event.getY())  </span><br><span class="line">                &amp;&amp; viewDragHelper != <span class="literal">null</span>  </span><br><span class="line">                &amp;&amp; Math.abs(initialY - event.getY()) &gt; viewDragHelper.getTouchSlop();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout parent, <span class="meta">@NonNull</span> V child, <span class="meta">@NonNull</span> MotionEvent event)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (!child.isShown()) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> event.getActionMasked();  </span><br><span class="line">        <span class="keyword">if</span> (state == STATE_DRAGGING &amp;&amp; action == MotionEvent.ACTION_DOWN) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (viewDragHelper != <span class="literal">null</span>) &#123;  </span><br><span class="line">            viewDragHelper.processTouchEvent(event);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// Record the velocity  </span></span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_DOWN) &#123;  </span><br><span class="line">            reset();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (velocityTracker == <span class="literal">null</span>) &#123;  </span><br><span class="line">            velocityTracker = VelocityTracker.obtain();  </span><br><span class="line">        &#125;  </span><br><span class="line">        velocityTracker.addMovement(event);  </span><br><span class="line">        <span class="comment">// The ViewDragHelper tries to capture only the top-most View. We have to explicitly tell it  </span></span><br><span class="line">        <span class="comment">// to capture the bottom sheet in case it is not captured and the touch slop is passed.        if (action == MotionEvent.ACTION_MOVE &amp;&amp; !ignoreEvents) &#123;  </span></span><br><span class="line">            <span class="keyword">if</span> (Math.abs(initialY - event.getY()) &gt; viewDragHelper.getTouchSlop()) &#123;  </span><br><span class="line">                viewDragHelper.captureChildView(child, event.getPointerId(event.getActionIndex()));  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> !ignoreEvents;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onStartNestedScroll</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout coordinatorLayout,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> V child,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> View directTargetChild,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> View target,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> axes,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> type)</span> &#123;  </span><br><span class="line">        lastNestedScrollDy = <span class="number">0</span>;  </span><br><span class="line">        nestedScrolled = <span class="literal">false</span>;  </span><br><span class="line">        <span class="keyword">return</span> (axes &amp; ViewCompat.SCROLL_AXIS_VERTICAL) != <span class="number">0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNestedPreScroll</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout coordinatorLayout,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> V child,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> View target,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> dx,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> dy,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> <span class="type">int</span>[] consumed,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> type)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (type == ViewCompat.TYPE_NON_TOUCH) &#123;  </span><br><span class="line">            <span class="comment">// Ignore fling here. The ViewDragHelper handles it.  </span></span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">View</span> <span class="variable">scrollingChild</span> <span class="operator">=</span> nestedScrollingChildRef != <span class="literal">null</span> ? nestedScrollingChildRef.get() : <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">if</span> (target != scrollingChild) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">currentTop</span> <span class="operator">=</span> child.getTop();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">newTop</span> <span class="operator">=</span> currentTop - dy;  </span><br><span class="line">        <span class="keyword">if</span> (dy &gt; <span class="number">0</span>) &#123; <span class="comment">// Upward  </span></span><br><span class="line">            <span class="keyword">if</span> (newTop &lt; getExpandedOffset()) &#123;  </span><br><span class="line">                consumed[<span class="number">1</span>] = currentTop - getExpandedOffset();  </span><br><span class="line">                ViewCompat.offsetTopAndBottom(child, -consumed[<span class="number">1</span>]);  </span><br><span class="line">                setStateInternal(STATE_EXPANDED);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="keyword">if</span> (!draggable) &#123;  </span><br><span class="line">                    <span class="comment">// Prevent dragging  </span></span><br><span class="line">                    <span class="keyword">return</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                consumed[<span class="number">1</span>] = dy;  </span><br><span class="line">                ViewCompat.offsetTopAndBottom(child, -dy);  </span><br><span class="line">                setStateInternal(STATE_DRAGGING);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dy &lt; <span class="number">0</span>) &#123; <span class="comment">// Downward  </span></span><br><span class="line">            <span class="keyword">if</span> (!target.canScrollVertically(-<span class="number">1</span>)) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (newTop &lt;= collapsedOffset || hideable) &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (!draggable) &#123;  </span><br><span class="line">                        <span class="comment">// Prevent dragging  </span></span><br><span class="line">                        <span class="keyword">return</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    consumed[<span class="number">1</span>] = dy;  </span><br><span class="line">                    ViewCompat.offsetTopAndBottom(child, -dy);  </span><br><span class="line">                    setStateInternal(STATE_DRAGGING);  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    consumed[<span class="number">1</span>] = currentTop - collapsedOffset;  </span><br><span class="line">                    ViewCompat.offsetTopAndBottom(child, -consumed[<span class="number">1</span>]);  </span><br><span class="line">                    setStateInternal(STATE_COLLAPSED);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        dispatchOnSlide(child.getTop());  </span><br><span class="line">        lastNestedScrollDy = dy;  </span><br><span class="line">        nestedScrolled = <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStopNestedScroll</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout coordinatorLayout,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> V child,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> View target,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> type)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (child.getTop() == getExpandedOffset()) &#123;  </span><br><span class="line">            setStateInternal(STATE_EXPANDED);  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (nestedScrollingChildRef == <span class="literal">null</span>  </span><br><span class="line">                || target != nestedScrollingChildRef.get()  </span><br><span class="line">                || !nestedScrolled) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">int</span> top;  </span><br><span class="line">        <span class="type">int</span> targetState;  </span><br><span class="line">        <span class="keyword">if</span> (lastNestedScrollDy &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                top = fitToContentsOffset;  </span><br><span class="line">                targetState = STATE_EXPANDED;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">currentTop</span> <span class="operator">=</span> child.getTop();  </span><br><span class="line">                <span class="keyword">if</span> (currentTop &gt; halfExpandedOffset) &#123;  </span><br><span class="line">                    top = halfExpandedOffset;  </span><br><span class="line">                    targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    top = expandedOffset;  </span><br><span class="line">                    targetState = STATE_EXPANDED;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hideable &amp;&amp; shouldHide(child, getYVelocity())) &#123;  </span><br><span class="line">            top = parentHeight;  </span><br><span class="line">            targetState = STATE_HIDDEN;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lastNestedScrollDy == <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">currentTop</span> <span class="operator">=</span> child.getTop();  </span><br><span class="line">            <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (Math.abs(currentTop - fitToContentsOffset) &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                    top = fitToContentsOffset;  </span><br><span class="line">                    targetState = STATE_EXPANDED;  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    top = collapsedOffset;  </span><br><span class="line">                    targetState = STATE_COLLAPSED;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="keyword">if</span> (currentTop &lt; halfExpandedOffset) &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (currentTop &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                        top = expandedOffset;  </span><br><span class="line">                        targetState = STATE_EXPANDED;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        top = halfExpandedOffset;  </span><br><span class="line">                        targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (Math.abs(currentTop - halfExpandedOffset) &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                        top = halfExpandedOffset;  </span><br><span class="line">                        targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        top = collapsedOffset;  </span><br><span class="line">                        targetState = STATE_COLLAPSED;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                top = collapsedOffset;  </span><br><span class="line">                targetState = STATE_COLLAPSED;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="comment">// Settle to nearest height.  </span></span><br><span class="line">                <span class="type">int</span> <span class="variable">currentTop</span> <span class="operator">=</span> child.getTop();  </span><br><span class="line">                <span class="keyword">if</span> (Math.abs(currentTop - halfExpandedOffset) &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                    top = halfExpandedOffset;  </span><br><span class="line">                    targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    top = collapsedOffset;  </span><br><span class="line">                    targetState = STATE_COLLAPSED;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        startSettlingAnimation(child, targetState, top, <span class="literal">false</span>);  </span><br><span class="line">        nestedScrolled = <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNestedScroll</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout coordinatorLayout,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> V child,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> View target,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> dxConsumed,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> dyConsumed,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> dxUnconsumed,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> dyUnconsumed,  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> type,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> <span class="type">int</span>[] consumed)</span> &#123;  </span><br><span class="line">        <span class="comment">// Overridden to prevent the default consumption of the entire scroll distance.  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onNestedPreFling</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> CoordinatorLayout coordinatorLayout,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> V child,  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> View target,  </span></span><br><span class="line"><span class="params">            <span class="type">float</span> velocityX,  </span></span><br><span class="line"><span class="params">            <span class="type">float</span> velocityY)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (nestedScrollingChildRef != <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span> target == nestedScrollingChildRef.get()  </span><br><span class="line">                    &amp;&amp; (state != STATE_EXPANDED  </span><br><span class="line">                    || <span class="built_in">super</span>.onNestedPreFling(coordinatorLayout, child, target, velocityX, velocityY));  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> whether the height of the expanded sheet is determined by the height of its contents,  </span></span><br><span class="line"><span class="comment">     * or if it is expanded in two stages (half the height of the parent container, full height of     * parent container).     */</span>    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFitToContents</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> fitToContents;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether the height of the expanded sheet is determined by the height of its contents, or     * if it is expanded in two stages (half the height of the parent container, full height of parent     * container). Default value is true.     *     * <span class="doctag">@param</span> fitToContents whether or not to fit the expanded sheet to its contents.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFitToContents</span><span class="params">(<span class="type">boolean</span> fitToContents)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.fitToContents == fitToContents) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">this</span>.fitToContents = fitToContents;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// If sheet is already laid out, recalculate the collapsed offset based on new setting.  </span></span><br><span class="line">        <span class="comment">// Otherwise, let onLayoutChild handle this later.        if (viewRef != null) &#123;  </span></span><br><span class="line">            calculateCollapsedOffset();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// Fix incorrect expanded settings depending on whether or not we are fitting sheet to contents.  </span></span><br><span class="line">        setStateInternal((<span class="built_in">this</span>.fitToContents &amp;&amp; state == STATE_HALF_EXPANDED) ? STATE_EXPANDED : state);  </span><br><span class="line">  </span><br><span class="line">        updateAccessibilityActions();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets the height of the bottom sheet when it is collapsed.     *     * <span class="doctag">@param</span> peekHeight The height of the collapsed bottom sheet in pixels, or &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     *                   #PEEK_HEIGHT_AUTO&#125; to configure the sheet to peek automatically at 16:9 ratio keyline.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_peekHeight     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPeekHeight</span><span class="params">(<span class="type">int</span> peekHeight)</span> &#123;  </span><br><span class="line">        setPeekHeight(peekHeight, <span class="literal">false</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets the height of the bottom sheet when it is collapsed while optionally animating between the     * old height and the new height.     *     * <span class="doctag">@param</span> peekHeight The height of the collapsed bottom sheet in pixels, or &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     *                   #PEEK_HEIGHT_AUTO&#125; to configure the sheet to peek automatically at 16:9 ratio keyline.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> animate    Whether to animate between the old height and the new height.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_peekHeight     */</span>    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">setPeekHeight</span><span class="params">(<span class="type">int</span> peekHeight, <span class="type">boolean</span> animate)</span> &#123;  </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="literal">false</span>;  </span><br><span class="line">        <span class="keyword">if</span> (peekHeight == PEEK_HEIGHT_AUTO) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (!peekHeightAuto) &#123;  </span><br><span class="line">                peekHeightAuto = <span class="literal">true</span>;  </span><br><span class="line">                layout = <span class="literal">true</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekHeightAuto || <span class="built_in">this</span>.peekHeight != peekHeight) &#123;  </span><br><span class="line">            peekHeightAuto = <span class="literal">false</span>;  </span><br><span class="line">            <span class="built_in">this</span>.peekHeight = Math.max(<span class="number">0</span>, peekHeight);  </span><br><span class="line">            layout = <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// If sheet is already laid out, recalculate the collapsed offset based on new setting.  </span></span><br><span class="line">        <span class="comment">// Otherwise, let onLayoutChild handle this later.        if (layout &amp;&amp; viewRef != null) &#123;  </span></span><br><span class="line">            calculateCollapsedOffset();  </span><br><span class="line">            <span class="keyword">if</span> (state == STATE_COLLAPSED) &#123;  </span><br><span class="line">                <span class="type">V</span> <span class="variable">view</span> <span class="operator">=</span> viewRef.get();  </span><br><span class="line">                <span class="keyword">if</span> (view != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (animate) &#123;  </span><br><span class="line">                        settleToStatePendingLayout(state);  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        view.requestLayout();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Gets the height of the bottom sheet when it is collapsed.     *     * <span class="doctag">@return</span> The height of the collapsed bottom sheet in pixels, or &#123;<span class="doctag">@link</span> #PEEK_HEIGHT_AUTO&#125; if the  </span></span><br><span class="line"><span class="comment">     * sheet is configured to peek automatically at 16:9 ratio keyline     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_peekHeight     */</span>    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPeekHeight</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> peekHeightAuto ? PEEK_HEIGHT_AUTO : peekHeight;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Determines the height of the BottomSheet in the &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125; state. The  </span></span><br><span class="line"><span class="comment">     * material guidelines recommended a value of 0.5, which results in the sheet filling half of the     * parent. The height of the BottomSheet will be smaller as this ratio is decreased and taller as     * it is increased. The default value is 0.5.     *     * <span class="doctag">@param</span> ratio a float between 0 and 1, representing the &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125; ratio.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_halfExpandedRatio     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHalfExpandedRatio</span><span class="params">(<span class="meta">@FloatRange(from = 0.0f, to = 1.0f)</span> <span class="type">float</span> ratio)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> ((ratio &lt;= <span class="number">0</span>) || (ratio &gt;= <span class="number">1</span>)) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;ratio must be a float value between 0 and 1&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">this</span>.halfExpandedRatio = ratio;  </span><br><span class="line">        <span class="comment">// If sheet is already laid out, recalculate the half expanded offset based on new setting.  </span></span><br><span class="line">        <span class="comment">// Otherwise, let onLayoutChild handle this later.        if (viewRef != null) &#123;  </span></span><br><span class="line">            calculateHalfExpandedOffset();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Gets the ratio for the height of the BottomSheet in the &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125; state.  </span></span><br><span class="line"><span class="comment">     *     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_halfExpandedRatio     */</span>    <span class="meta">@FloatRange(from = 0.0f, to = 1.0f)</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getHalfExpandedRatio</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> halfExpandedRatio;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Determines the top offset of the BottomSheet in the &#123;<span class="doctag">@link</span> #STATE_EXPANDED&#125; state when  </span></span><br><span class="line"><span class="comment">     * fitsToContent is false. The default value is 0, which results in the sheet matching the     * parent&#x27;s top.     *     * <span class="doctag">@param</span> offset an integer value greater than equal to 0, representing the &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     *               #STATE_EXPANDED&#125; offset. Value must not exceed the offset in the half expanded state.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_expandedOffset     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setExpandedOffset</span><span class="params">(<span class="type">int</span> offset)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;offset must be greater than or equal to 0&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">this</span>.expandedOffset = offset;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Returns the current expanded offset. If &#123;<span class="doctag">@code</span> fitToContents&#125; is true, it will automatically  </span></span><br><span class="line"><span class="comment">     * pick the offset depending on the height of the content.     *     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_expandedOffset     */</span>    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getExpandedOffset</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> fitToContents ? fitToContentsOffset : expandedOffset;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether this bottom sheet can hide when it is swiped down.     *     * <span class="doctag">@param</span> hideable &#123;<span class="doctag">@code</span> true&#125; to make this bottom sheet hideable.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_hideable  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHideable</span><span class="params">(<span class="type">boolean</span> hideable)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.hideable != hideable) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.hideable = hideable;  </span><br><span class="line">            <span class="keyword">if</span> (!hideable &amp;&amp; state == STATE_HIDDEN) &#123;  </span><br><span class="line">                <span class="comment">// Lift up to collapsed state  </span></span><br><span class="line">                setState(STATE_COLLAPSED);  </span><br><span class="line">            &#125;  </span><br><span class="line">            updateAccessibilityActions();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Gets whether this bottom sheet can hide when it is swiped down.     *     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if this bottom sheet can hide.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_hideable  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHideable</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> hideable;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether this bottom sheet should skip the collapsed state when it is being hidden after it     * is expanded once. Setting this to true has no effect unless the sheet is hideable.     *     * <span class="doctag">@param</span> skipCollapsed True if the bottom sheet should skip the collapsed state.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_skipCollapsed     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSkipCollapsed</span><span class="params">(<span class="type">boolean</span> skipCollapsed)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.skipCollapsed = skipCollapsed;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether this bottom sheet should skip the collapsed state when it is being hidden after it     * is expanded once.     *     * <span class="doctag">@return</span> Whether the bottom sheet should skip the collapsed state.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref  </span></span><br><span class="line"><span class="comment">     * com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_skipCollapsed     */</span>    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getSkipCollapsed</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> skipCollapsed;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether this bottom sheet is can be collapsed/expanded by dragging. Note: When disabling     * dragging, an app will require to implement a custom way to expand/collapse the bottom sheet     *     * <span class="doctag">@param</span> draggable &#123;<span class="doctag">@code</span> false&#125; to prevent dragging the sheet to collapse and expand  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_draggable  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDraggable</span><span class="params">(<span class="type">boolean</span> draggable)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.draggable = draggable;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDraggable</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> draggable;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets save flags to be preserved in bottomsheet on configuration change.     *     * <span class="doctag">@param</span> flags bitwise int of &#123;<span class="doctag">@link</span> #SAVE_PEEK_HEIGHT&#125;, &#123;<span class="doctag">@link</span> #SAVE_FIT_TO_CONTENTS&#125;, &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     *              #SAVE_HIDEABLE&#125;, &#123;<span class="doctag">@link</span> #SAVE_SKIP_COLLAPSED&#125;, &#123;<span class="doctag">@link</span> #SAVE_ALL&#125; and &#123;<span class="doctag">@link</span> #SAVE_NONE&#125;.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@attr</span> ref com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_saveFlags  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getSaveFlags()  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSaveFlags</span><span class="params">(<span class="meta">@SaveFlags</span> <span class="type">int</span> flags)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.saveFlags = flags;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Returns the save flags.     *     * <span class="doctag">@attr</span> ref com.google.android.material.R.styleable#BottomSheetBehavior_Layout_behavior_saveFlags  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setSaveFlags(int)  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="meta">@SaveFlags</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSaveFlags</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.saveFlags;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets a callback to be notified of bottom sheet events.     *     * <span class="doctag">@param</span> callback The callback to notify when bottom sheet events occur.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span> use &#123;<span class="doctag">@link</span> #addBottomSheetCallback(BottomSheetCallback)&#125; and &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     * #removeBottomSheetCallback(BottomSheetCallback)&#125; instead  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="meta">@Deprecated</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBottomSheetCallback</span><span class="params">(BottomSheetCallback callback)</span> &#123;  </span><br><span class="line">        Log.w(  </span><br><span class="line">                TAG,  </span><br><span class="line">                <span class="string">&quot;BottomSheetBehavior now supports multiple callbacks. `setBottomSheetCallback()` removes&quot;</span>  </span><br><span class="line">                        + <span class="string">&quot; all existing callbacks, including ones set internally by library authors, which&quot;</span>  </span><br><span class="line">                        + <span class="string">&quot; may result in unintended behavior. This may change in the future. Please use&quot;</span>  </span><br><span class="line">                        + <span class="string">&quot; `addBottomSheetCallback()` and `removeBottomSheetCallback()` instead to set your&quot;</span>  </span><br><span class="line">                        + <span class="string">&quot; own callbacks.&quot;</span>);  </span><br><span class="line">        callbacks.clear();  </span><br><span class="line">        <span class="keyword">if</span> (callback != <span class="literal">null</span>) &#123;  </span><br><span class="line">            callbacks.add(callback);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Adds a callback to be notified of bottom sheet events.     *     * <span class="doctag">@param</span> callback The callback to notify when bottom sheet events occur.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBottomSheetCallback</span><span class="params">(<span class="meta">@NonNull</span> BottomSheetCallback callback)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (!callbacks.contains(callback)) &#123;  </span><br><span class="line">            callbacks.add(callback);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Removes a previously added callback.     *     * <span class="doctag">@param</span> callback The callback to remove.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeBottomSheetCallback</span><span class="params">(<span class="meta">@NonNull</span> BottomSheetCallback callback)</span> &#123;  </span><br><span class="line">        callbacks.remove(callback);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets the state of the bottom sheet. The bottom sheet will transition to that state with     * animation.     *     * <span class="doctag">@param</span> state One of &#123;<span class="doctag">@link</span> #STATE_COLLAPSED&#125;, &#123;<span class="doctag">@link</span> #STATE_EXPANDED&#125;, &#123;<span class="doctag">@link</span> #STATE_HIDDEN&#125;,  </span></span><br><span class="line"><span class="comment">     *              or &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125;.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(<span class="meta">@State</span> <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (state == <span class="built_in">this</span>.state) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (viewRef == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="comment">// The view is not laid out yet; modify mState and let onLayoutChild handle it later  </span></span><br><span class="line">            <span class="keyword">if</span> (state == STATE_COLLAPSED  </span><br><span class="line">                    || state == STATE_EXPANDED  </span><br><span class="line">                    || state == STATE_HALF_EXPANDED  </span><br><span class="line">                    || (hideable &amp;&amp; state == STATE_HIDDEN)) &#123;  </span><br><span class="line">                <span class="built_in">this</span>.state = state;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        settleToStatePendingLayout(state);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether this bottom sheet should adjust it&#x27;s position based on the system gesture area on     * Android Q and above.     *     * &lt;p&gt;Note: the bottom sheet will only adjust it&#x27;s position if it would be unable to be scrolled  </span></span><br><span class="line"><span class="comment">     * upwards because the peekHeight is less than the gesture inset margins,(because that would cause     * a gesture conflict), gesture navigation is enabled, and this &#123;<span class="doctag">@code</span> ignoreGestureInsetBottom&#125;  </span></span><br><span class="line"><span class="comment">     * flag is false.     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGestureInsetBottomIgnored</span><span class="params">(<span class="type">boolean</span> gestureInsetBottomIgnored)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.gestureInsetBottomIgnored = gestureInsetBottomIgnored;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Returns whether this bottom sheet should adjust it&#x27;s position based on the system gesture area.     */</span>    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isGestureInsetBottomIgnored</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> gestureInsetBottomIgnored;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">settleToStatePendingLayout</span><span class="params">(<span class="meta">@State</span> <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">V</span> <span class="variable">child</span> <span class="operator">=</span> viewRef.get();  </span><br><span class="line">        <span class="keyword">if</span> (child == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// Start the animation; wait until a pending layout if there is one.  </span></span><br><span class="line">        <span class="type">ViewParent</span> <span class="variable">parent</span> <span class="operator">=</span> child.getParent();  </span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span> &amp;&amp; parent.isLayoutRequested() &amp;&amp; ViewCompat.isAttachedToWindow(child)) &#123;  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">finalState</span> <span class="operator">=</span> state;  </span><br><span class="line">            child.post(  </span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;  </span><br><span class="line">                        <span class="meta">@Override</span>  </span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">                            settleToState(child, finalState);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            settleToState(child, state);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Gets the current state of the bottom sheet.     *     * <span class="doctag">@return</span> One of &#123;<span class="doctag">@link</span> #STATE_EXPANDED&#125;, &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125;, &#123;<span class="doctag">@link</span> #STATE_COLLAPSED&#125;,  </span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #STATE_DRAGGING&#125;, &#123;<span class="doctag">@link</span> #STATE_SETTLING&#125;, or &#123;<span class="doctag">@link</span> #STATE_HALF_EXPANDED&#125;.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="meta">@State</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getState</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> state;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setStateInternal</span><span class="params">(<span class="meta">@State</span> <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.state == state) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">this</span>.state = state;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (viewRef == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">View</span> <span class="variable">bottomSheet</span> <span class="operator">=</span> viewRef.get();  </span><br><span class="line">        <span class="keyword">if</span> (bottomSheet == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (state == STATE_EXPANDED) &#123;  </span><br><span class="line">            updateImportantForAccessibility(<span class="literal">true</span>);  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == STATE_HALF_EXPANDED || state == STATE_HIDDEN || state == STATE_COLLAPSED) &#123;  </span><br><span class="line">            updateImportantForAccessibility(<span class="literal">false</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        updateDrawableForTargetState(state);  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callbacks.size(); i++) &#123;  </span><br><span class="line">            callbacks.get(i).onStateChanged(bottomSheet, state);  </span><br><span class="line">        &#125;  </span><br><span class="line">        updateAccessibilityActions();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateDrawableForTargetState</span><span class="params">(<span class="meta">@State</span> <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (state == STATE_SETTLING) &#123;  </span><br><span class="line">            <span class="comment">// Special case: we want to know which state we&#x27;re settling to, so wait for another call.  </span></span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">expand</span> <span class="operator">=</span> state == STATE_EXPANDED;  </span><br><span class="line">        <span class="keyword">if</span> (isShapeExpanded != expand) &#123;  </span><br><span class="line">            isShapeExpanded = expand;  </span><br><span class="line">            <span class="keyword">if</span> (materialShapeDrawable != <span class="literal">null</span> &amp;&amp; interpolatorAnimator != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (interpolatorAnimator.isRunning()) &#123;  </span><br><span class="line">                    interpolatorAnimator.reverse();  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    <span class="type">float</span> <span class="variable">to</span> <span class="operator">=</span> expand ? <span class="number">0f</span> : <span class="number">1f</span>;  </span><br><span class="line">                    <span class="type">float</span> <span class="variable">from</span> <span class="operator">=</span> <span class="number">1f</span> - to;  </span><br><span class="line">                    interpolatorAnimator.setFloatValues(from, to);  </span><br><span class="line">                    interpolatorAnimator.start();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">calculatePeekHeight</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (peekHeightAuto) &#123;  </span><br><span class="line">            <span class="keyword">return</span> Math.max(peekHeightMin, parentHeight - parentWidth * <span class="number">9</span> / <span class="number">16</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> peekHeight;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calculateCollapsedOffset</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">peek</span> <span class="operator">=</span> calculatePeekHeight();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">            collapsedOffset = Math.max(parentHeight - peek, fitToContentsOffset);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            collapsedOffset = parentHeight - peek;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calculateHalfExpandedOffset</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.halfExpandedOffset = (<span class="type">int</span>) (parentHeight * (<span class="number">1</span> - halfExpandedRatio));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;  </span><br><span class="line">        activePointerId = ViewDragHelper.INVALID_POINTER;  </span><br><span class="line">        <span class="keyword">if</span> (velocityTracker != <span class="literal">null</span>) &#123;  </span><br><span class="line">            velocityTracker.recycle();  </span><br><span class="line">            velocityTracker = <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">restoreOptionalState</span><span class="params">(<span class="meta">@NonNull</span> SavedState ss)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.saveFlags == SAVE_NONE) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.saveFlags == SAVE_ALL || (<span class="built_in">this</span>.saveFlags &amp; SAVE_PEEK_HEIGHT) == SAVE_PEEK_HEIGHT) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.peekHeight = ss.peekHeight;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.saveFlags == SAVE_ALL  </span><br><span class="line">                || (<span class="built_in">this</span>.saveFlags &amp; SAVE_FIT_TO_CONTENTS) == SAVE_FIT_TO_CONTENTS) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.fitToContents = ss.fitToContents;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.saveFlags == SAVE_ALL || (<span class="built_in">this</span>.saveFlags &amp; SAVE_HIDEABLE) == SAVE_HIDEABLE) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.hideable = ss.hideable;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.saveFlags == SAVE_ALL  </span><br><span class="line">                || (<span class="built_in">this</span>.saveFlags &amp; SAVE_SKIP_COLLAPSED) == SAVE_SKIP_COLLAPSED) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.skipCollapsed = ss.skipCollapsed;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shouldHide</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">float</span> yvel)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (skipCollapsed) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (child.getTop() &lt; collapsedOffset) &#123;  </span><br><span class="line">            <span class="comment">// It should not hide, but collapse.  </span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">peek</span> <span class="operator">=</span> calculatePeekHeight();  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">newTop</span> <span class="operator">=</span> child.getTop() + yvel * HIDE_FRICTION;  </span><br><span class="line">        <span class="keyword">return</span> Math.abs(newTop - collapsedOffset) / (<span class="type">float</span>) peek &gt; HIDE_THRESHOLD;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//针对viewpager联动  </span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isFirstFind</span> <span class="operator">=</span> <span class="literal">true</span>; <span class="comment">//第一次寻找联动View，为viewPager添加滑动监听  </span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;Integer, Boolean&gt; isScrollViewOnTopMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); <span class="comment">//关联页数与能否滑动flag的Map  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">currentPagePosition</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//当前ViewPager的页数  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentScrollViewOnTop</span><span class="params">(<span class="type">boolean</span> scrollViewOnTop)</span> &#123;  </span><br><span class="line">        isScrollViewOnTopMap.put(currentPagePosition, scrollViewOnTop);  </span><br><span class="line">        Log.d(TAG, isScrollViewOnTopMap.toString());  </span><br><span class="line">        notifyScrollView();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> View globalView;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">notifyScrollView</span><span class="params">()</span> &#123;  </span><br><span class="line">        nestedScrollingChildRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(findScrollingChild(globalView));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    <span class="meta">@VisibleForTesting</span>    View <span class="title function_">findScrollingChild</span><span class="params">(View view)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        globalView = view;  </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> isScrollViewOnTopMap.getOrDefault(currentPagePosition, <span class="literal">false</span>);  </span><br><span class="line">        <span class="keyword">if</span> (b) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (ViewCompat.isNestedScrollingEnabled(view)) &#123;  </span><br><span class="line">            <span class="keyword">return</span> view;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewPager) &#123;  </span><br><span class="line">            <span class="type">ViewPager</span> <span class="variable">viewPager</span> <span class="operator">=</span> (ViewPager) view;  </span><br><span class="line">            <span class="keyword">if</span> (isFirstFind) &#123;  </span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Objects.requireNonNull(viewPager.getAdapter()).getCount(); i++) &#123;  </span><br><span class="line">                    isScrollViewOnTopMap.put(i, <span class="literal">true</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">                viewPager.addOnPageChangeListener(<span class="keyword">new</span> <span class="title class_">ViewPager</span>.OnPageChangeListener() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrolled</span><span class="params">(<span class="type">int</span> position, <span class="type">float</span> positionOffset, <span class="type">int</span> positionOffsetPixels)</span> &#123;  </span><br><span class="line">                        currentPagePosition = position;  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="type">int</span> position)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrollStateChanged</span><span class="params">(<span class="type">int</span> state)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br><span class="line">                isFirstFind = <span class="literal">false</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="comment">// 修改  </span></span><br><span class="line">            <span class="type">View</span> <span class="variable">currentViewPagerChild</span> <span class="operator">=</span> viewPager.getChildAt(viewPager.getCurrentItem());  </span><br><span class="line"><span class="comment">//            View currentViewPagerChild = ViewPagerUtils.getCurrentView(viewPager);  </span></span><br><span class="line">            <span class="type">View</span> <span class="variable">scrollingChild</span> <span class="operator">=</span> findScrollingChild(currentViewPagerChild);  </span><br><span class="line">            <span class="keyword">if</span> (scrollingChild != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">return</span> scrollingChild;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> currentViewPagerChild;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;  </span><br><span class="line">            <span class="type">ViewGroup</span> <span class="variable">group</span> <span class="operator">=</span> (ViewGroup) view;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, count = group.getChildCount(); i &lt; count; i++) &#123;  </span><br><span class="line">                <span class="type">View</span> <span class="variable">scrollingChild</span> <span class="operator">=</span> findScrollingChild(group.getChildAt(i));  </span><br><span class="line">                <span class="keyword">if</span> (scrollingChild != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="keyword">return</span> scrollingChild;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createMaterialShapeDrawable</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> Context context, AttributeSet attrs, <span class="type">boolean</span> hasBackgroundTint)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.createMaterialShapeDrawable(context, attrs, hasBackgroundTint, <span class="literal">null</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createMaterialShapeDrawable</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> Context context,  </span></span><br><span class="line"><span class="params">            AttributeSet attrs,  </span></span><br><span class="line"><span class="params">            <span class="type">boolean</span> hasBackgroundTint,  </span></span><br><span class="line"><span class="params">            <span class="meta">@Nullable</span> ColorStateList bottomSheetColor)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.shapeThemingEnabled) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.shapeAppearanceModelDefault =  </span><br><span class="line">                    ShapeAppearanceModel.builder(context, attrs, R.attr.bottomSheetStyle, DEF_STYLE_RES)  </span><br><span class="line">                            .build();  </span><br><span class="line">  </span><br><span class="line">            <span class="built_in">this</span>.materialShapeDrawable = <span class="keyword">new</span> <span class="title class_">MaterialShapeDrawable</span>(shapeAppearanceModelDefault);  </span><br><span class="line">            <span class="built_in">this</span>.materialShapeDrawable.initializeElevationOverlay(context);  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (hasBackgroundTint &amp;&amp; bottomSheetColor != <span class="literal">null</span>) &#123;  </span><br><span class="line">                materialShapeDrawable.setFillColor(bottomSheetColor);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="comment">// If the tint isn&#x27;t set, use the theme default background color.  </span></span><br><span class="line">                <span class="type">TypedValue</span> <span class="variable">defaultColor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TypedValue</span>();  </span><br><span class="line">                context.getTheme().resolveAttribute(android.R.attr.colorBackground, defaultColor, <span class="literal">true</span>);  </span><br><span class="line">                materialShapeDrawable.setTint(defaultColor.data);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createShapeValueAnimator</span><span class="params">()</span> &#123;  </span><br><span class="line">        interpolatorAnimator = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">1f</span>);  </span><br><span class="line">        interpolatorAnimator.setDuration(CORNER_ANIMATION_DURATION);  </span><br><span class="line">        interpolatorAnimator.addUpdateListener(  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AnimatorUpdateListener</span>() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAnimationUpdate</span><span class="params">(<span class="meta">@NonNull</span> ValueAnimator animation)</span> &#123;  </span><br><span class="line">                        <span class="type">float</span> <span class="variable">value</span> <span class="operator">=</span> (<span class="type">float</span>) animation.getAnimatedValue();  </span><br><span class="line">                        <span class="keyword">if</span> (materialShapeDrawable != <span class="literal">null</span>) &#123;  </span><br><span class="line">                            materialShapeDrawable.setInterpolation(value);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setSystemGestureInsets</span><span class="params">(<span class="meta">@NonNull</span> CoordinatorLayout parent)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.Q &amp;&amp; !isGestureInsetBottomIgnored()) &#123;  </span><br><span class="line">            <span class="type">WindowInsets</span> <span class="variable">windowInsets</span> <span class="operator">=</span> parent.getRootWindowInsets();  </span><br><span class="line">            <span class="keyword">if</span> (windowInsets != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">systemMandatoryInsetsBottom</span> <span class="operator">=</span> windowInsets.getSystemGestureInsets().bottom;  </span><br><span class="line">                peekHeight += systemMandatoryInsetsBottom;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="title function_">getYVelocity</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (velocityTracker == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        velocityTracker.computeCurrentVelocity(<span class="number">1000</span>, maximumVelocity);  </span><br><span class="line">        <span class="keyword">return</span> velocityTracker.getYVelocity(activePointerId);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">settleToState</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> top;  </span><br><span class="line">        <span class="keyword">if</span> (state == STATE_COLLAPSED) &#123;  </span><br><span class="line">            top = collapsedOffset;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == STATE_HALF_EXPANDED) &#123;  </span><br><span class="line">            top = halfExpandedOffset;  </span><br><span class="line">            <span class="keyword">if</span> (fitToContents &amp;&amp; top &lt;= fitToContentsOffset) &#123;  </span><br><span class="line">                <span class="comment">// Skip to the expanded state if we would scroll past the height of the contents.  </span></span><br><span class="line">                state = STATE_EXPANDED;  </span><br><span class="line">                top = fitToContentsOffset;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == STATE_EXPANDED) &#123;  </span><br><span class="line">            top = getExpandedOffset();  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hideable &amp;&amp; state == STATE_HIDDEN) &#123;  </span><br><span class="line">            top = parentHeight;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Illegal state argument: &quot;</span> + state);  </span><br><span class="line">        &#125;  </span><br><span class="line">        startSettlingAnimation(child, state, top, <span class="literal">false</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">startSettlingAnimation</span><span class="params">(View child, <span class="type">int</span> state, <span class="type">int</span> top, <span class="type">boolean</span> settleFromViewDragHelper)</span> &#123;  </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">startedSettling</span> <span class="operator">=</span>  </span><br><span class="line">                settleFromViewDragHelper  </span><br><span class="line">                        ? viewDragHelper.settleCapturedViewAt(child.getLeft(), top)  </span><br><span class="line">                        : viewDragHelper.smoothSlideViewTo(child, child.getLeft(), top);  </span><br><span class="line">        <span class="keyword">if</span> (startedSettling) &#123;  </span><br><span class="line">            setStateInternal(STATE_SETTLING);  </span><br><span class="line">            <span class="comment">// STATE_SETTLING won&#x27;t animate the material shape, so do that here with the target state.  </span></span><br><span class="line">            updateDrawableForTargetState(state);  </span><br><span class="line">            <span class="keyword">if</span> (settleRunnable == <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// If the singleton SettleRunnable instance has not been instantiated, create it.  </span></span><br><span class="line">                settleRunnable = <span class="keyword">new</span> <span class="title class_">SettleRunnable</span>(child, state);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="comment">// If the SettleRunnable has not been posted, post it with the correct state.  </span></span><br><span class="line">            <span class="keyword">if</span> (settleRunnable.isPosted == <span class="literal">false</span>) &#123;  </span><br><span class="line">                settleRunnable.targetState = state;  </span><br><span class="line">                ViewCompat.postOnAnimation(child, settleRunnable);  </span><br><span class="line">                settleRunnable.isPosted = <span class="literal">true</span>;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="comment">// Otherwise, if it has been posted, just update the target state.  </span></span><br><span class="line">                settleRunnable.targetState = state;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            setStateInternal(state);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    MaterialShapeDrawable <span class="title function_">getMaterialShapeDrawable</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> materialShapeDrawable;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ViewDragHelper.<span class="type">Callback</span> <span class="variable">dragCallback</span> <span class="operator">=</span>  </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ViewDragHelper</span>.Callback() &#123;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryCaptureView</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">int</span> pointerId)</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (state == STATE_DRAGGING) &#123;  </span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">if</span> (touchingScrollingChild) &#123;  </span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">if</span> (state == STATE_EXPANDED &amp;&amp; activePointerId == pointerId) &#123;  </span><br><span class="line">                        <span class="type">View</span> <span class="variable">scroll</span> <span class="operator">=</span> nestedScrollingChildRef != <span class="literal">null</span> ? nestedScrollingChildRef.get() : <span class="literal">null</span>;  </span><br><span class="line">                        <span class="keyword">if</span> (scroll != <span class="literal">null</span> &amp;&amp; scroll.canScrollVertically(-<span class="number">1</span>)) &#123;  </span><br><span class="line">                            <span class="comment">// Let the content scroll up  </span></span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">return</span> viewRef != <span class="literal">null</span> &amp;&amp; viewRef.get() == child;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewPositionChanged</span><span class="params">(  </span></span><br><span class="line"><span class="params">                        <span class="meta">@NonNull</span> View changedView, <span class="type">int</span> left, <span class="type">int</span> top, <span class="type">int</span> dx, <span class="type">int</span> dy)</span> &#123;  </span><br><span class="line">                    dispatchOnSlide(top);  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewDragStateChanged</span><span class="params">(<span class="type">int</span> state)</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (state == ViewDragHelper.STATE_DRAGGING &amp;&amp; draggable) &#123;  </span><br><span class="line">                        setStateInternal(STATE_DRAGGING);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">releasedLow</span><span class="params">(<span class="meta">@NonNull</span> View child)</span> &#123;  </span><br><span class="line">                    <span class="comment">// Needs to be at least half way to the bottom.  </span></span><br><span class="line">                    <span class="keyword">return</span> child.getTop() &gt; (parentHeight + getExpandedOffset()) / <span class="number">2</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewReleased</span><span class="params">(<span class="meta">@NonNull</span> View releasedChild, <span class="type">float</span> xvel, <span class="type">float</span> yvel)</span> &#123;  </span><br><span class="line">                    <span class="type">int</span> top;  </span><br><span class="line">                    <span class="meta">@State</span> <span class="type">int</span> targetState;  </span><br><span class="line">                    <span class="keyword">if</span> (yvel &lt; <span class="number">0</span>) &#123; <span class="comment">// Moving up  </span></span><br><span class="line">                        <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                            top = fitToContentsOffset;  </span><br><span class="line">                            targetState = STATE_EXPANDED;  </span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                            <span class="type">int</span> <span class="variable">currentTop</span> <span class="operator">=</span> releasedChild.getTop();  </span><br><span class="line">                            <span class="keyword">if</span> (currentTop &gt; halfExpandedOffset) &#123;  </span><br><span class="line">                                top = halfExpandedOffset;  </span><br><span class="line">                                targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                                top = expandedOffset;  </span><br><span class="line">                                targetState = STATE_EXPANDED;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hideable &amp;&amp; shouldHide(releasedChild, yvel)) &#123;  </span><br><span class="line">                        <span class="comment">// Hide if the view was either released low or it was a significant vertical swipe  </span></span><br><span class="line">                        <span class="comment">// otherwise settle to closest expanded state.                        if ((Math.abs(xvel) &lt; Math.abs(yvel) &amp;&amp; yvel &gt; SIGNIFICANT_VEL_THRESHOLD)  </span></span><br><span class="line">                                || releasedLow(releasedChild)) &#123;  </span><br><span class="line">                            top = parentHeight;  </span><br><span class="line">                            targetState = STATE_HIDDEN;  </span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                            top = fitToContentsOffset;  </span><br><span class="line">                            targetState = STATE_EXPANDED;  </span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Math.abs(releasedChild.getTop() - expandedOffset)  </span><br><span class="line">                                &lt; Math.abs(releasedChild.getTop() - halfExpandedOffset)) &#123;  </span><br><span class="line">                            top = expandedOffset;  </span><br><span class="line">                            targetState = STATE_EXPANDED;  </span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                            top = halfExpandedOffset;  </span><br><span class="line">                            targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (yvel == <span class="number">0.f</span> || Math.abs(xvel) &gt; Math.abs(yvel)) &#123;  </span><br><span class="line">                        <span class="comment">// If the Y velocity is 0 or the swipe was mostly horizontal indicated by the X velocity  </span></span><br><span class="line">                        <span class="comment">// being greater than the Y velocity, settle to the nearest correct height.                        int currentTop = releasedChild.getTop();  </span></span><br><span class="line">                        <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                            <span class="keyword">if</span> (Math.abs(currentTop - fitToContentsOffset)  </span><br><span class="line">                                    &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                                top = fitToContentsOffset;  </span><br><span class="line">                                targetState = STATE_EXPANDED;  </span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                                top = collapsedOffset;  </span><br><span class="line">                                targetState = STATE_COLLAPSED;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                            <span class="keyword">if</span> (currentTop &lt; halfExpandedOffset) &#123;  </span><br><span class="line">                                <span class="keyword">if</span> (currentTop &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                                    top = expandedOffset;  </span><br><span class="line">                                    targetState = STATE_EXPANDED;  </span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                                    top = halfExpandedOffset;  </span><br><span class="line">                                    targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                                <span class="keyword">if</span> (Math.abs(currentTop - halfExpandedOffset)  </span><br><span class="line">                                        &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                                    top = halfExpandedOffset;  </span><br><span class="line">                                    targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                                    top = collapsedOffset;  </span><br><span class="line">                                    targetState = STATE_COLLAPSED;  </span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123; <span class="comment">// Moving Down  </span></span><br><span class="line">                        <span class="keyword">if</span> (fitToContents) &#123;  </span><br><span class="line">                            top = collapsedOffset;  </span><br><span class="line">                            targetState = STATE_COLLAPSED;  </span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                            <span class="comment">// Settle to the nearest correct height.  </span></span><br><span class="line">                            <span class="type">int</span> <span class="variable">currentTop</span> <span class="operator">=</span> releasedChild.getTop();  </span><br><span class="line">                            <span class="keyword">if</span> (Math.abs(currentTop - halfExpandedOffset)  </span><br><span class="line">                                    &lt; Math.abs(currentTop - collapsedOffset)) &#123;  </span><br><span class="line">                                top = halfExpandedOffset;  </span><br><span class="line">                                targetState = STATE_HALF_EXPANDED;  </span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                                top = collapsedOffset;  </span><br><span class="line">                                targetState = STATE_COLLAPSED;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    startSettlingAnimation(releasedChild, targetState, top, <span class="literal">true</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">clampViewPositionVertical</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">int</span> top, <span class="type">int</span> dy)</span> &#123;  </span><br><span class="line">                    <span class="keyword">return</span> MathUtils.clamp(  </span><br><span class="line">                            top, getExpandedOffset(), hideable ? parentHeight : collapsedOffset);  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">clampViewPositionHorizontal</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">int</span> left, <span class="type">int</span> dx)</span> &#123;  </span><br><span class="line">                    <span class="keyword">return</span> child.getLeft();  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getViewVerticalDragRange</span><span class="params">(<span class="meta">@NonNull</span> View child)</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (hideable) &#123;  </span><br><span class="line">                        <span class="keyword">return</span> parentHeight;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        <span class="keyword">return</span> collapsedOffset;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dispatchOnSlide</span><span class="params">(<span class="type">int</span> top)</span> &#123;  </span><br><span class="line">        <span class="type">View</span> <span class="variable">bottomSheet</span> <span class="operator">=</span> viewRef.get();  </span><br><span class="line">        <span class="keyword">if</span> (bottomSheet != <span class="literal">null</span> &amp;&amp; !callbacks.isEmpty()) &#123;  </span><br><span class="line">            <span class="type">float</span> <span class="variable">slideOffset</span> <span class="operator">=</span>  </span><br><span class="line">                    (top &gt; collapsedOffset || collapsedOffset == getExpandedOffset())  </span><br><span class="line">                            ? (<span class="type">float</span>) (collapsedOffset - top) / (parentHeight - collapsedOffset)  </span><br><span class="line">                            : (<span class="type">float</span>) (collapsedOffset - top) / (collapsedOffset - getExpandedOffset());  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callbacks.size(); i++) &#123;  </span><br><span class="line">                callbacks.get(i).onSlide(bottomSheet, slideOffset);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@VisibleForTesting</span>  </span><br><span class="line">    <span class="type">int</span> <span class="title function_">getPeekHeightMin</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> peekHeightMin;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Disables the shaped corner &#123;<span class="doctag">@link</span> ShapeAppearanceModel&#125; interpolation transition animations.  </span></span><br><span class="line"><span class="comment">     * Will have no effect unless the sheet utilizes a &#123;<span class="doctag">@link</span> MaterialShapeDrawable&#125; with set shape  </span></span><br><span class="line"><span class="comment">     * theming properties. Only For use in UI testing.     *     * <span class="doctag">@hide</span>  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@RestrictTo(LIBRARY_GROUP)</span>  </span><br><span class="line">    <span class="meta">@VisibleForTesting</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disableShapeAnimations</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="comment">// Sets the shape value animator to null, prevents animations from occuring during testing.  </span></span><br><span class="line">        interpolatorAnimator = <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">SettleRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> View view;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> isPosted;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@State</span>  </span><br><span class="line">        <span class="type">int</span> targetState;  </span><br><span class="line">  </span><br><span class="line">        SettleRunnable(View view, <span class="meta">@State</span> <span class="type">int</span> targetState) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.view = view;  </span><br><span class="line">            <span class="built_in">this</span>.targetState = targetState;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">            <span class="keyword">if</span> (viewDragHelper != <span class="literal">null</span> &amp;&amp; viewDragHelper.continueSettling(<span class="literal">true</span>)) &#123;  </span><br><span class="line">                ViewCompat.postOnAnimation(view, <span class="built_in">this</span>);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                setStateInternal(targetState);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="built_in">this</span>.isPosted = <span class="literal">false</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * State persisted across instances     */</span>    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SavedState</span> <span class="keyword">extends</span> <span class="title class_">AbsSavedState</span> &#123;  </span><br><span class="line">        <span class="meta">@State</span>  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> state;  </span><br><span class="line">        <span class="type">int</span> peekHeight;  </span><br><span class="line">        <span class="type">boolean</span> fitToContents;  </span><br><span class="line">        <span class="type">boolean</span> hideable;  </span><br><span class="line">        <span class="type">boolean</span> skipCollapsed;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">SavedState</span><span class="params">(<span class="meta">@NonNull</span> Parcel source)</span> &#123;  </span><br><span class="line">            <span class="built_in">this</span>(source, <span class="literal">null</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">SavedState</span><span class="params">(<span class="meta">@NonNull</span> Parcel source, ClassLoader loader)</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>(source, loader);  </span><br><span class="line">            <span class="comment">//noinspection ResourceType  </span></span><br><span class="line">            state = source.readInt();  </span><br><span class="line">            peekHeight = source.readInt();  </span><br><span class="line">            fitToContents = source.readInt() == <span class="number">1</span>;  </span><br><span class="line">            hideable = source.readInt() == <span class="number">1</span>;  </span><br><span class="line">            skipCollapsed = source.readInt() == <span class="number">1</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">SavedState</span><span class="params">(Parcelable superState, <span class="meta">@NonNull</span> MinibarViewPagerBottomSheetBehavior&lt;?&gt; behavior)</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>(superState);  </span><br><span class="line">            <span class="built_in">this</span>.state = behavior.getState();  </span><br><span class="line">            <span class="built_in">this</span>.peekHeight = behavior.getPeekHeight();  </span><br><span class="line">            <span class="built_in">this</span>.fitToContents = behavior.isFitToContents();  </span><br><span class="line">            <span class="built_in">this</span>.hideable = behavior.isHideable();  </span><br><span class="line">            <span class="built_in">this</span>.skipCollapsed = behavior.getSkipCollapsed();  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Deprecated</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">SavedState</span><span class="params">(Parcelable superstate, <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>(superstate);  </span><br><span class="line">            <span class="built_in">this</span>.state = state;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeToParcel</span><span class="params">(<span class="meta">@NonNull</span> Parcel out, <span class="type">int</span> flags)</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>.writeToParcel(out, flags);  </span><br><span class="line">            out.writeInt(state);  </span><br><span class="line">            out.writeInt(peekHeight);  </span><br><span class="line">            out.writeInt(fitToContents ? <span class="number">1</span> : <span class="number">0</span>);  </span><br><span class="line">            out.writeInt(hideable ? <span class="number">1</span> : <span class="number">0</span>);  </span><br><span class="line">            out.writeInt(skipCollapsed ? <span class="number">1</span> : <span class="number">0</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;SavedState&gt; CREATOR =  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ClassLoaderCreator</span>&lt;SavedState&gt;() &#123;  </span><br><span class="line">                    <span class="meta">@NonNull</span>  </span><br><span class="line">                    <span class="meta">@Override</span>                    <span class="keyword">public</span> SavedState <span class="title function_">createFromParcel</span><span class="params">(<span class="meta">@NonNull</span> Parcel in, ClassLoader loader)</span> &#123;  </span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SavedState</span>(in, loader);  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@Nullable</span>  </span><br><span class="line">                    <span class="meta">@Override</span>                    <span class="keyword">public</span> SavedState <span class="title function_">createFromParcel</span><span class="params">(<span class="meta">@NonNull</span> Parcel in)</span> &#123;  </span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SavedState</span>(in, <span class="literal">null</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@NonNull</span>  </span><br><span class="line">                    <span class="meta">@Override</span>                    <span class="keyword">public</span> SavedState[] newArray(<span class="type">int</span> size) &#123;  </span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SavedState</span>[size];  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * A utility function to get the &#123;<span class="doctag">@link</span> BottomSheetBehavior&#125; associated with the &#123;<span class="doctag">@code</span> view&#125;.  </span></span><br><span class="line"><span class="comment">     *     * <span class="doctag">@param</span> view The &#123;<span class="doctag">@link</span> View&#125; with &#123;<span class="doctag">@link</span> BottomSheetBehavior&#125;.  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The &#123;<span class="doctag">@link</span> BottomSheetBehavior&#125; associated with the &#123;<span class="doctag">@code</span> view&#125;.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="meta">@NonNull</span>  </span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;V <span class="keyword">extends</span> <span class="title class_">View</span>&gt; MinibarViewPagerBottomSheetBehavior&lt;V&gt; <span class="title function_">from</span><span class="params">(<span class="meta">@NonNull</span> V view)</span> &#123;  </span><br><span class="line">        ViewGroup.<span class="type">LayoutParams</span> <span class="variable">params</span> <span class="operator">=</span> view.getLayoutParams();  </span><br><span class="line">        <span class="keyword">if</span> (!(params <span class="keyword">instanceof</span> LayoutParams)) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;The view is not a child of CoordinatorLayout&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        CoordinatorLayout.Behavior&lt;?&gt; behavior =  </span><br><span class="line">                ((LayoutParams) params).getBehavior();  </span><br><span class="line">        <span class="keyword">if</span> (!(behavior <span class="keyword">instanceof</span> MinibarViewPagerBottomSheetBehavior)) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;The view is not associated with BottomSheetBehavior&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> (MinibarViewPagerBottomSheetBehavior&lt;V&gt;) behavior;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Sets whether the BottomSheet should update the accessibility status of its &#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     * CoordinatorLayout&#125; siblings when expanded.  </span></span><br><span class="line"><span class="comment">     *     * &lt;p&gt;Set this to true if the expanded state of the sheet blocks access to siblings (e.g., when  </span></span><br><span class="line"><span class="comment">     * the sheet expands over the full screen).     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpdateImportantForAccessibilityOnSiblings</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="type">boolean</span> updateImportantForAccessibilityOnSiblings)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.updateImportantForAccessibilityOnSiblings = updateImportantForAccessibilityOnSiblings;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateImportantForAccessibility</span><span class="params">(<span class="type">boolean</span> expanded)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (viewRef == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ViewParent</span> <span class="variable">viewParent</span> <span class="operator">=</span> viewRef.get().getParent();  </span><br><span class="line">        <span class="keyword">if</span> (!(viewParent <span class="keyword">instanceof</span> CoordinatorLayout)) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">CoordinatorLayout</span> <span class="variable">parent</span> <span class="operator">=</span> (CoordinatorLayout) viewParent;  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">childCount</span> <span class="operator">=</span> parent.getChildCount();  </span><br><span class="line">        <span class="keyword">if</span> ((VERSION.SDK_INT &gt;= VERSION_CODES.JELLY_BEAN) &amp;&amp; expanded) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (importantForAccessibilityMap == <span class="literal">null</span>) &#123;  </span><br><span class="line">                importantForAccessibilityMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(childCount);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="comment">// The important for accessibility values of the child views have been saved already.  </span></span><br><span class="line">                <span class="keyword">return</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; childCount; i++) &#123;  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">View</span> <span class="variable">child</span> <span class="operator">=</span> parent.getChildAt(i);  </span><br><span class="line">            <span class="keyword">if</span> (child == viewRef.get()) &#123;  </span><br><span class="line">                <span class="keyword">continue</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (expanded) &#123;  </span><br><span class="line">                <span class="comment">// Saves the important for accessibility value of the child view.  </span></span><br><span class="line">                <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.JELLY_BEAN) &#123;  </span><br><span class="line">                    importantForAccessibilityMap.put(child, child.getImportantForAccessibility());  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">if</span> (updateImportantForAccessibilityOnSiblings) &#123;  </span><br><span class="line">                    ViewCompat.setImportantForAccessibility(  </span><br><span class="line">                            child, ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="keyword">if</span> (updateImportantForAccessibilityOnSiblings  </span><br><span class="line">                        &amp;&amp; importantForAccessibilityMap != <span class="literal">null</span>  </span><br><span class="line">                        &amp;&amp; importantForAccessibilityMap.containsKey(child)) &#123;  </span><br><span class="line">                    <span class="comment">// Restores the original important for accessibility value of the child view.  </span></span><br><span class="line">                    ViewCompat.setImportantForAccessibility(child, importantForAccessibilityMap.get(child));  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (!expanded) &#123;  </span><br><span class="line">            importantForAccessibilityMap = <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateAccessibilityActions</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (viewRef == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">V</span> <span class="variable">child</span> <span class="operator">=</span> viewRef.get();  </span><br><span class="line">        <span class="keyword">if</span> (child == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        ViewCompat.removeAccessibilityAction(child, AccessibilityNodeInfoCompat.ACTION_COLLAPSE);  </span><br><span class="line">        ViewCompat.removeAccessibilityAction(child, AccessibilityNodeInfoCompat.ACTION_EXPAND);  </span><br><span class="line">        ViewCompat.removeAccessibilityAction(child, AccessibilityNodeInfoCompat.ACTION_DISMISS);  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (hideable &amp;&amp; state != STATE_HIDDEN) &#123;  </span><br><span class="line">            addAccessibilityActionForState(child, AccessibilityActionCompat.ACTION_DISMISS, STATE_HIDDEN);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">switch</span> (state) &#123;  </span><br><span class="line">            <span class="keyword">case</span> STATE_EXPANDED: &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">nextState</span> <span class="operator">=</span> fitToContents ? STATE_COLLAPSED : STATE_HALF_EXPANDED;  </span><br><span class="line">                addAccessibilityActionForState(  </span><br><span class="line">                        child, AccessibilityActionCompat.ACTION_COLLAPSE, nextState);  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">case</span> STATE_HALF_EXPANDED: &#123;  </span><br><span class="line">                addAccessibilityActionForState(  </span><br><span class="line">                        child, AccessibilityActionCompat.ACTION_COLLAPSE, STATE_COLLAPSED);  </span><br><span class="line">                addAccessibilityActionForState(  </span><br><span class="line">                        child, AccessibilityActionCompat.ACTION_EXPAND, STATE_EXPANDED);  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">case</span> STATE_COLLAPSED: &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">nextState</span> <span class="operator">=</span> fitToContents ? STATE_EXPANDED : STATE_HALF_EXPANDED;  </span><br><span class="line">                addAccessibilityActionForState(child, AccessibilityActionCompat.ACTION_EXPAND, nextState);  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">default</span>: <span class="comment">// fall out  </span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addAccessibilityActionForState</span><span class="params">(  </span></span><br><span class="line"><span class="params">            V child, AccessibilityActionCompat action, <span class="keyword">final</span> <span class="type">int</span> state)</span> &#123;  </span><br><span class="line">        ViewCompat.replaceAccessibilityAction(  </span><br><span class="line">                child,  </span><br><span class="line">                action,  </span><br><span class="line">                <span class="literal">null</span>,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AccessibilityViewCommand</span>() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">perform</span><span class="params">(<span class="meta">@NonNull</span> View view, <span class="meta">@Nullable</span> CommandArguments arguments)</span> &#123;  </span><br><span class="line">                        setState(state);  </span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MinibarViewPagerBottomSheetDialog.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.base.custom;  </span><br><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment"> * Copyright (C) 2015 The Android Open Source Project * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */</span>  </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.view.View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;  </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.android.material.color.MaterialColors.isColorLight;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> android.content.Context;  </span><br><span class="line"><span class="keyword">import</span> android.content.res.ColorStateList;  </span><br><span class="line"><span class="keyword">import</span> android.content.res.TypedArray;  </span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;  </span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.ColorDrawable;  </span><br><span class="line"><span class="keyword">import</span> android.os.Build.VERSION;  </span><br><span class="line"><span class="keyword">import</span> android.os.Build.VERSION_CODES;  </span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;  </span><br><span class="line"><span class="keyword">import</span> android.util.TypedValue;  </span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;  </span><br><span class="line"><span class="keyword">import</span> android.view.View;  </span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;  </span><br><span class="line"><span class="keyword">import</span> android.view.Window;  </span><br><span class="line"><span class="keyword">import</span> android.view.WindowManager.LayoutParams;  </span><br><span class="line"><span class="keyword">import</span> android.widget.FrameLayout;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.LayoutRes;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;  </span><br><span class="line"><span class="keyword">import</span> androidx.annotation.StyleRes;  </span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatDialog;  </span><br><span class="line"><span class="keyword">import</span> androidx.coordinatorlayout.widget.CoordinatorLayout;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.AccessibilityDelegateCompat;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.OnApplyWindowInsetsListener;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.ViewCompat;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.WindowInsetsCompat;  </span><br><span class="line"><span class="keyword">import</span> androidx.core.view.accessibility.AccessibilityNodeInfoCompat;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.base.custom_bottomsheet.R;  </span><br><span class="line"><span class="keyword">import</span> com.google.android.material.shape.MaterialShapeDrawable;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Base class for &#123;<span class="doctag">@link</span> android.app.Dialog&#125;s styled as a bottom sheet.  </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;In edge to edge mode, padding will be added automatically to the top when sliding under the  </span></span><br><span class="line"><span class="comment"> * status bar. Padding can be applied automatically to the left, right, or bottom if any of * `paddingBottomSystemWindowInsets`, `paddingLeftSystemWindowInsets`, or * `paddingRightSystemWindowInsets` are set to true in the style. */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinibarViewPagerBottomSheetDialog</span> <span class="keyword">extends</span> <span class="title class_">AppCompatDialog</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> MinibarViewPagerBottomSheetBehavior&lt;FrameLayout&gt; behavior;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> FrameLayout container;  </span><br><span class="line">    <span class="keyword">private</span> CoordinatorLayout coordinator;  </span><br><span class="line">    <span class="keyword">private</span> FrameLayout bottomSheet;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> dismissWithAnimation;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">cancelable</span> <span class="operator">=</span> <span class="literal">true</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">canceledOnTouchOutside</span> <span class="operator">=</span> <span class="literal">true</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> canceledOnTouchOutsideSet;  </span><br><span class="line">    <span class="keyword">private</span> MinibarViewPagerBottomSheetBehavior.BottomSheetCallback edgeToEdgeCallback;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> edgeToEdgeEnabled;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinibarViewPagerBottomSheetDialog</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>(context, <span class="number">0</span>);  </span><br><span class="line">  </span><br><span class="line">        edgeToEdgeEnabled = <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinibarViewPagerBottomSheetDialog</span><span class="params">(<span class="meta">@NonNull</span> Context context, <span class="meta">@StyleRes</span> <span class="type">int</span> theme)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>(context, getThemeResId(context, theme));  </span><br><span class="line">        <span class="comment">// We hide the title bar for any style configuration. Otherwise, there will be a gap  </span></span><br><span class="line">        <span class="comment">// above the bottom sheet when it is expanded.        supportRequestWindowFeature(Window.FEATURE_NO_TITLE);  </span></span><br><span class="line">  </span><br><span class="line">        edgeToEdgeEnabled = <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">MinibarViewPagerBottomSheetDialog</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> Context context, <span class="type">boolean</span> cancelable, OnCancelListener cancelListener)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>(context, cancelable, cancelListener);  </span><br><span class="line">        supportRequestWindowFeature(Window.FEATURE_NO_TITLE);  </span><br><span class="line">        <span class="built_in">this</span>.cancelable = cancelable;  </span><br><span class="line">  </span><br><span class="line">        edgeToEdgeEnabled = <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContentView</span><span class="params">(<span class="meta">@LayoutRes</span> <span class="type">int</span> layoutResId)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.setContentView(wrapInBottomSheet(layoutResId, <span class="literal">null</span>, <span class="literal">null</span>));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);  </span><br><span class="line">        <span class="type">Window</span> <span class="variable">window</span> <span class="operator">=</span> getWindow();  </span><br><span class="line">        <span class="keyword">if</span> (window != <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.LOLLIPOP) &#123;  </span><br><span class="line">                <span class="comment">// The status bar should always be transparent because of the window animation.  </span></span><br><span class="line">                window.setStatusBarColor(<span class="number">0</span>);  </span><br><span class="line">  </span><br><span class="line">                window.addFlags(LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);  </span><br><span class="line">                <span class="keyword">if</span> (VERSION.SDK_INT &lt; VERSION_CODES.M) &#123;  </span><br><span class="line">                    <span class="comment">// It can be transparent for API 23 and above because we will handle switching the status  </span></span><br><span class="line">                    <span class="comment">// bar icons to light or dark as appropriate. For API 21 and API 22 we just set the                    // translucent status bar.                    window.addFlags(LayoutParams.FLAG_TRANSLUCENT_STATUS);  </span></span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            window.setLayout(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContentView</span><span class="params">(View view)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.setContentView(wrapInBottomSheet(<span class="number">0</span>, view, <span class="literal">null</span>));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContentView</span><span class="params">(View view, ViewGroup.LayoutParams params)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.setContentView(wrapInBottomSheet(<span class="number">0</span>, view, params));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCancelable</span><span class="params">(<span class="type">boolean</span> cancelable)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.setCancelable(cancelable);  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.cancelable != cancelable) &#123;  </span><br><span class="line">            <span class="built_in">this</span>.cancelable = cancelable;  </span><br><span class="line">            <span class="keyword">if</span> (behavior != <span class="literal">null</span>) &#123;  </span><br><span class="line">                behavior.setHideable(cancelable);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.onStart();  </span><br><span class="line">        <span class="keyword">if</span> (behavior != <span class="literal">null</span> &amp;&amp; behavior.getState() == MinibarViewPagerBottomSheetBehavior.STATE_HIDDEN) &#123;  </span><br><span class="line">            behavior.setState(MinibarViewPagerBottomSheetBehavior.STATE_COLLAPSED);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttachedToWindow</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.onAttachedToWindow();  </span><br><span class="line">        <span class="type">Window</span> <span class="variable">window</span> <span class="operator">=</span> getWindow();  </span><br><span class="line">        <span class="keyword">if</span> (window != <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.LOLLIPOP) &#123;  </span><br><span class="line">                <span class="comment">// If the navigation bar is transparent at all the BottomSheet should be edge to edge.  </span></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">drawEdgeToEdge</span> <span class="operator">=</span>  </span><br><span class="line">                        edgeToEdgeEnabled &amp;&amp; Color.alpha(window.getNavigationBarColor()) &lt; <span class="number">255</span>;  </span><br><span class="line">                <span class="keyword">if</span> (container != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    container.setFitsSystemWindows(!drawEdgeToEdge);  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">if</span> (coordinator != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    coordinator.setFitsSystemWindows(!drawEdgeToEdge);  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">if</span> (drawEdgeToEdge) &#123;  </span><br><span class="line">                    <span class="comment">// Automatically set up edge to edge flags if we should be drawing edge to edge.  </span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">edgeToEdgeFlags</span> <span class="operator">=</span>  </span><br><span class="line">                            View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION | View.SYSTEM_UI_FLAG_LAYOUT_STABLE;  </span><br><span class="line">                    window.getDecorView().setSystemUiVisibility(edgeToEdgeFlags);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * This function can be called from a few different use cases, including Swiping the dialog down     * or calling `dismiss()` from a `BottomSheetDialogFragment`, tapping outside a dialog, etc...     * &lt;p&gt;If this function is called from a swipe down interaction, or dismissWithAnimation is false,  </span></span><br><span class="line"><span class="comment">     * then keep the default behavior.     */</span>    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span> &#123;  </span><br><span class="line">        MinibarViewPagerBottomSheetBehavior&lt;FrameLayout&gt; behavior = getBehavior();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (!dismissWithAnimation || behavior.getState() == MinibarViewPagerBottomSheetBehavior.STATE_HIDDEN) &#123;  </span><br><span class="line">            <span class="built_in">super</span>.cancel();  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            behavior.setState(MinibarViewPagerBottomSheetBehavior.STATE_HIDDEN);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCanceledOnTouchOutside</span><span class="params">(<span class="type">boolean</span> cancel)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.setCanceledOnTouchOutside(cancel);  </span><br><span class="line">        <span class="keyword">if</span> (cancel &amp;&amp; !cancelable) &#123;  </span><br><span class="line">            cancelable = <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        canceledOnTouchOutside = cancel;  </span><br><span class="line">        canceledOnTouchOutsideSet = <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@NonNull</span>  </span><br><span class="line">    <span class="keyword">public</span> MinibarViewPagerBottomSheetBehavior&lt;FrameLayout&gt; <span class="title function_">getBehavior</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (behavior == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="comment">// The content hasn&#x27;t been set, so the behavior doesn&#x27;t exist yet. Let&#x27;s create it.  </span></span><br><span class="line">            ensureContainerAndBehavior();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> behavior;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Set to perform the swipe down animation when dismissing instead of the window animation for the     * dialog.     *     * <span class="doctag">@param</span> dismissWithAnimation True if swipe down animation should be used when dismissing.  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDismissWithAnimation</span><span class="params">(<span class="type">boolean</span> dismissWithAnimation)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.dismissWithAnimation = dismissWithAnimation;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Returns if dismissing will perform the swipe down animation on the bottom sheet, rather than     * the window animation for the dialog.     */</span>    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getDismissWithAnimation</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> dismissWithAnimation;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Returns if edge to edge behavior is enabled for this dialog.     */</span>    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getEdgeToEdgeEnabled</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> edgeToEdgeEnabled;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Creates the container layout which must exist to find the behavior     */</span>    <span class="keyword">private</span> FrameLayout <span class="title function_">ensureContainerAndBehavior</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (container == <span class="literal">null</span>) &#123;  </span><br><span class="line">            container =  </span><br><span class="line">                    (FrameLayout) View.inflate(getContext(), R.layout.design_minibar_bottom_sheet_dialog, <span class="literal">null</span>);  </span><br><span class="line">  </span><br><span class="line">            coordinator = (CoordinatorLayout) container.findViewById(R.id.coordinator);  </span><br><span class="line">            bottomSheet = (FrameLayout) container.findViewById(R.id.design_bottom_sheet);  </span><br><span class="line">  </span><br><span class="line">            behavior = MinibarViewPagerBottomSheetBehavior.from(bottomSheet);  </span><br><span class="line">            behavior.addBottomSheetCallback(bottomSheetCallback);  </span><br><span class="line">            behavior.setHideable(cancelable);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> container;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> View <span class="title function_">wrapInBottomSheet</span><span class="params">(  </span></span><br><span class="line"><span class="params">            <span class="type">int</span> layoutResId, <span class="meta">@Nullable</span> View view, <span class="meta">@Nullable</span> ViewGroup.LayoutParams params)</span> &#123;  </span><br><span class="line">        ensureContainerAndBehavior();  </span><br><span class="line">        <span class="type">CoordinatorLayout</span> <span class="variable">coordinator</span> <span class="operator">=</span> (CoordinatorLayout) container.findViewById(R.id.coordinator);  </span><br><span class="line">        <span class="keyword">if</span> (layoutResId != <span class="number">0</span> &amp;&amp; view == <span class="literal">null</span>) &#123;  </span><br><span class="line">            view = getLayoutInflater().inflate(layoutResId, coordinator, <span class="literal">false</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (edgeToEdgeEnabled) &#123;  </span><br><span class="line">            ViewCompat.setOnApplyWindowInsetsListener(  </span><br><span class="line">                    bottomSheet,  </span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">OnApplyWindowInsetsListener</span>() &#123;  </span><br><span class="line">                        <span class="meta">@Override</span>  </span><br><span class="line">                        <span class="keyword">public</span> WindowInsetsCompat <span class="title function_">onApplyWindowInsets</span><span class="params">(View view, WindowInsetsCompat insets)</span> &#123;  </span><br><span class="line">                            <span class="keyword">if</span> (edgeToEdgeCallback != <span class="literal">null</span>) &#123;  </span><br><span class="line">                                behavior.removeBottomSheetCallback(edgeToEdgeCallback);  </span><br><span class="line">                            &#125;  </span><br><span class="line">  </span><br><span class="line">                            <span class="keyword">if</span> (insets != <span class="literal">null</span>) &#123;  </span><br><span class="line">                                edgeToEdgeCallback = <span class="keyword">new</span> <span class="title class_">EdgeToEdgeCallback</span>(bottomSheet, insets);  </span><br><span class="line">                                behavior.addBottomSheetCallback(edgeToEdgeCallback);  </span><br><span class="line">                            &#125;  </span><br><span class="line">  </span><br><span class="line">                            <span class="keyword">return</span> insets;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        bottomSheet.removeAllViews();  </span><br><span class="line">        <span class="keyword">if</span> (params == <span class="literal">null</span>) &#123;  </span><br><span class="line">            bottomSheet.addView(view);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            bottomSheet.addView(view, params);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// We treat the CoordinatorLayout as outside the dialog though it is technically inside  </span></span><br><span class="line">        coordinator  </span><br><span class="line">                .findViewById(R.id.touch_outside)  </span><br><span class="line">                .setOnClickListener(  </span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;  </span><br><span class="line">                            <span class="meta">@Override</span>  </span><br><span class="line">                            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;  </span><br><span class="line">                                <span class="keyword">if</span> (cancelable &amp;&amp; isShowing() &amp;&amp; shouldWindowCloseOnTouchOutside()) &#123;  </span><br><span class="line">                                    cancel();  </span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;);  </span><br><span class="line">        <span class="comment">// Handle accessibility events  </span></span><br><span class="line">        ViewCompat.setAccessibilityDelegate(  </span><br><span class="line">                bottomSheet,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AccessibilityDelegateCompat</span>() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onInitializeAccessibilityNodeInfo</span><span class="params">(  </span></span><br><span class="line"><span class="params">                            View host, <span class="meta">@NonNull</span> AccessibilityNodeInfoCompat info)</span> &#123;  </span><br><span class="line">                        <span class="built_in">super</span>.onInitializeAccessibilityNodeInfo(host, info);  </span><br><span class="line">                        <span class="keyword">if</span> (cancelable) &#123;  </span><br><span class="line">                            info.addAction(AccessibilityNodeInfoCompat.ACTION_DISMISS);  </span><br><span class="line">                            info.setDismissable(<span class="literal">true</span>);  </span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                            info.setDismissable(<span class="literal">false</span>);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">performAccessibilityAction</span><span class="params">(View host, <span class="type">int</span> action, Bundle args)</span> &#123;  </span><br><span class="line">                        <span class="keyword">if</span> (action == AccessibilityNodeInfoCompat.ACTION_DISMISS &amp;&amp; cancelable) &#123;  </span><br><span class="line">                            cancel();  </span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        <span class="keyword">return</span> <span class="built_in">super</span>.performAccessibilityAction(host, action, args);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br><span class="line">        bottomSheet.setOnTouchListener(  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">View</span>.OnTouchListener() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouch</span><span class="params">(View view, MotionEvent event)</span> &#123;  </span><br><span class="line">                        <span class="comment">// Consume the event and prevent it from falling through  </span></span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br><span class="line">        <span class="keyword">return</span> container;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shouldWindowCloseOnTouchOutside</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (!canceledOnTouchOutsideSet) &#123;  </span><br><span class="line">            <span class="type">TypedArray</span> <span class="variable">a</span> <span class="operator">=</span>  </span><br><span class="line">                    getContext().obtainStyledAttributes(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;android.R.attr.windowCloseOnTouchOutside&#125;);  </span><br><span class="line">            canceledOnTouchOutside = a.getBoolean(<span class="number">0</span>, <span class="literal">true</span>);  </span><br><span class="line">            a.recycle();  </span><br><span class="line">            canceledOnTouchOutsideSet = <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> canceledOnTouchOutside;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getThemeResId</span><span class="params">(Context context, <span class="type">int</span> themeId)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (themeId == <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="type">TypedValue</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TypedValue</span>();  </span><br><span class="line">            <span class="keyword">if</span> (context.getTheme().resolveAttribute(  </span><br><span class="line">                    com.google.android.material.R.attr.bottomSheetDialogTheme, outValue, <span class="literal">true</span>)) &#123;  </span><br><span class="line">                themeId = outValue.resourceId;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                themeId = com.google.android.material.R.style.Theme_Design_Light_BottomSheetDialog;  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> themeId;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeDefaultCallback</span><span class="params">()</span> &#123;  </span><br><span class="line">        behavior.removeBottomSheetCallback(bottomSheetCallback);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@NonNull</span>  </span><br><span class="line">    <span class="keyword">private</span> MinibarViewPagerBottomSheetBehavior.<span class="type">BottomSheetCallback</span> <span class="variable">bottomSheetCallback</span> <span class="operator">=</span>  </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">MinibarViewPagerBottomSheetBehavior</span>.BottomSheetCallback() &#123;  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(  </span></span><br><span class="line"><span class="params">                        <span class="meta">@NonNull</span> View bottomSheet, <span class="meta">@MinibarViewPagerBottomSheetBehavior</span>.State <span class="type">int</span> newState)</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (newState == MinibarViewPagerBottomSheetBehavior.STATE_HIDDEN) &#123;  </span><br><span class="line">                        cancel();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSlide</span><span class="params">(<span class="meta">@NonNull</span> View bottomSheet, <span class="type">float</span> slideOffset)</span> &#123;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EdgeToEdgeCallback</span> <span class="keyword">extends</span> <span class="title class_">MinibarViewPagerBottomSheetBehavior</span>.BottomSheetCallback &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> lightBottomSheet;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> lightStatusBar;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> WindowInsetsCompat insetsCompat;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">EdgeToEdgeCallback</span><span class="params">(  </span></span><br><span class="line"><span class="params">                <span class="meta">@NonNull</span> <span class="keyword">final</span> View bottomSheet, <span class="meta">@NonNull</span> WindowInsetsCompat insetsCompat)</span> &#123;  </span><br><span class="line">            <span class="built_in">this</span>.insetsCompat = insetsCompat;  </span><br><span class="line">            lightStatusBar =  </span><br><span class="line">                    VERSION.SDK_INT &gt;= VERSION_CODES.M  </span><br><span class="line">                            &amp;&amp; (bottomSheet.getSystemUiVisibility() &amp; SYSTEM_UI_FLAG_LIGHT_STATUS_BAR) != <span class="number">0</span>;  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// Try to find the background color to automatically change the status bar icons so they will  </span></span><br><span class="line">            <span class="comment">// still be visible when the bottomsheet slides underneath the status bar.            ColorStateList backgroundTint;  </span></span><br><span class="line">            <span class="type">MaterialShapeDrawable</span> <span class="variable">msd</span> <span class="operator">=</span> MinibarViewPagerBottomSheetBehavior.from(bottomSheet).getMaterialShapeDrawable();  </span><br><span class="line">            <span class="keyword">if</span> (msd != <span class="literal">null</span>) &#123;  </span><br><span class="line">                backgroundTint = msd.getFillColor();  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                backgroundTint = ViewCompat.getBackgroundTintList(bottomSheet);  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (backgroundTint != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// First check for a tint  </span></span><br><span class="line">                lightBottomSheet = isColorLight(backgroundTint.getDefaultColor());  </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bottomSheet.getBackground() <span class="keyword">instanceof</span> ColorDrawable) &#123;  </span><br><span class="line">                <span class="comment">// Then check for the background color  </span></span><br><span class="line">                lightBottomSheet = isColorLight(((ColorDrawable) bottomSheet.getBackground()).getColor());  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="comment">// Otherwise don&#x27;t change the status bar color  </span></span><br><span class="line">                lightBottomSheet = lightStatusBar;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(<span class="meta">@NonNull</span> View bottomSheet, <span class="type">int</span> newState)</span> &#123;  </span><br><span class="line">            setPaddingForPosition(bottomSheet);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSlide</span><span class="params">(<span class="meta">@NonNull</span> View bottomSheet, <span class="type">float</span> slideOffset)</span> &#123;  </span><br><span class="line">            setPaddingForPosition(bottomSheet);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setPaddingForPosition</span><span class="params">(View bottomSheet)</span> &#123;  </span><br><span class="line">            <span class="keyword">if</span> (bottomSheet.getTop() &lt; insetsCompat.getSystemWindowInsetTop()) &#123;  </span><br><span class="line">                <span class="comment">// If the bottomsheet is light, we should set light status bar so the icons are visible  </span></span><br><span class="line">                <span class="comment">// since the bottomsheet is now under the status bar.                setLightStatusBar(bottomSheet, lightBottomSheet);  </span></span><br><span class="line">                <span class="comment">// Smooth transition into status bar when drawing edge to edge.  </span></span><br><span class="line">                bottomSheet.setPadding(  </span><br><span class="line">                        bottomSheet.getPaddingLeft(),  </span><br><span class="line">                        (insetsCompat.getSystemWindowInsetTop() - bottomSheet.getTop()),  </span><br><span class="line">                        bottomSheet.getPaddingRight(),  </span><br><span class="line">                        bottomSheet.getPaddingBottom());  </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bottomSheet.getTop() != <span class="number">0</span>) &#123;  </span><br><span class="line">                <span class="comment">// Reset the status bar icons to the original color because the bottomsheet is not under the  </span></span><br><span class="line">                <span class="comment">// status bar.                setLightStatusBar(bottomSheet, lightStatusBar);  </span></span><br><span class="line">                bottomSheet.setPadding(  </span><br><span class="line">                        bottomSheet.getPaddingLeft(),  </span><br><span class="line">                        <span class="number">0</span>,  </span><br><span class="line">                        bottomSheet.getPaddingRight(),  </span><br><span class="line">                        bottomSheet.getPaddingBottom());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setLightStatusBar</span><span class="params">(<span class="meta">@NonNull</span> View view, <span class="type">boolean</span> isLight)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.M) &#123;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">flags</span> <span class="operator">=</span> view.getSystemUiVisibility();  </span><br><span class="line">            <span class="keyword">if</span> (isLight) &#123;  </span><br><span class="line">                flags |= View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                flags &amp;= ~View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;  </span><br><span class="line">            &#125;  </span><br><span class="line">            view.setSystemUiVisibility(flags);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="true">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://music.163.com/song/media/outer/url?id=723174.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci='bea144b43eefb358981c'
        data-cs='a36c22fec87740cbe5e17b541731a652d8e2785d'
        data-r='gitalk'
        data-o='ArnoFrost'
        data-a='ArnoFrost'
        data-d='true'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">1. 问题背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%86%B2%E7%AA%81%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">2. 冲突原因分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89-MyViewPagerBottomSheetBehavior"><span class="toc-number">3.</span> <span class="toc-text">3. 自定义 MyViewPagerBottomSheetBehavior</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%A4%84%E7%90%86-ViewPager-%E8%81%94%E5%8A%A8"><span class="toc-number">4.</span> <span class="toc-text">4. 处理 ViewPager 联动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%B7%E6%96%B0%E6%BB%91%E5%8A%A8%E6%8E%A7%E4%BB%B6%E6%96%B9%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text">5. 刷新滑动控件方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%9A%B4%E9%9C%B2%E8%AE%BE%E7%BD%AE%E6%BB%91%E5%8A%A8%E9%A1%B6%E9%83%A8%E7%8A%B6%E6%80%81%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">6. 暴露设置滑动顶部状态的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%9B%91%E5%90%AC-RecyclerView-%E6%BB%91%E5%8A%A8"><span class="toc-number">7.</span> <span class="toc-text">7. 监听 RecyclerView 滑动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-number">8.</span> <span class="toc-text">8. 实现细节</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">9.</span> <span class="toc-text">9. 参考资料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">10.</span> <span class="toc-text">10. 完整代码</span></a></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-M1XD2J0EJY', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


</html>
